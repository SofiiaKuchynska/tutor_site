<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>7 –∫–ª–∞—Å: –†–æ–∑–∫—Ä–∏—Ç—Ç—è –¥—É–∂–æ–∫ (50 –∑–∞–≤–¥–∞–Ω—å)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['\\(', '\\)']], displayMath: [['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; overflow: hidden; overscroll-behavior: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .task-card { border: 1px solid #e2e8f0; transition: all 0.3s ease; }
        
        .input-base {
            width: 100%; padding: 0.875rem 1rem; border-radius: 1rem; border: 2px solid #e2e8f0; 
            background-color: #f8fafc; font-weight: 600; color: #1e293b; outline: none; transition: all 0.2s;
            font-size: 16px; /* –ó–∞–ø–æ–±—ñ–≥–∞—î –∞–≤—Ç–æ-–∑—É–º—É –Ω–∞ iPhone */
        }
        .input-base:focus { border-color: #6366f1; background-color: #ffffff; }
        .input-correct { border-color: #22c55e !important; background-color: #dcfce7 !important; color: #166534 !important; }
        .input-wrong { border-color: #ef4444 !important; background-color: #fee2e2 !important; color: #991b1b !important; }
        
        .canvas-container { position: relative; background: #ffffff; cursor: crosshair; touch-action: none; width: 100%; height: 100%; }
        .tool-active { background-color: #4f46e5; color: #ffffff; }
        
        .option-btn { transition: all 0.2s; word-wrap: break-word; }
        .option-btn:hover:not(:disabled) { background-color: #f1f5f9; border-color: #94a3b8; }
        .option-correct { background-color: #dcfce7 !important; border-color: #22c55e !important; color: #166534 !important; }
        .option-wrong { background-color: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b !important; }

        .match-btn { padding: 1rem; border: 2px solid #e2e8f0; border-radius: 1rem; cursor: pointer; transition: all 0.2s; text-align: center; font-weight: 600; background: #f8fafc; font-size: 0.9rem;}
        .match-selected { border-color: #4f46e5 !important; background: #e0e7ff !important; transform: scale(1.02); }
        .match-wrong { border-color: #ef4444 !important; background: #fee2e2 !important; }
        
        .mobile-tab-active { color: #4f46e5; border-top-color: #4f46e5; background-color: #e0e7ff; }
    </style>
</head>
<body class="h-screen flex flex-col lg:flex-row text-slate-900">

    <div id="panel-tasks" class="w-full lg:w-1/2 flex flex-col bg-white border-r border-slate-200 shadow-xl z-10 h-full relative">
        <header class="p-4 sm:p-5 border-b border-slate-100 flex justify-between items-center bg-white/95 backdrop-blur-md shrink-0 z-20">
            <div>
                <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight text-slate-800">–†–æ–∑–∫—Ä–∏—Ç—Ç—è –¥—É–∂–æ–∫</h1>
                <p class="text-[10px] sm:text-[11px] font-bold text-indigo-500 uppercase tracking-widest mt-1">7 –ö–ª–∞—Å ‚Ä¢ –ú–µ–≥–∞-–Ü–Ω—Ç–µ–Ω—Å–∏–≤ ‚Ä¢ 50 –ó–∞–≤–¥–∞–Ω—å</p>
            </div>
            <div class="flex flex-col items-end w-24 sm:w-32">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-[10px] sm:text-xs font-bold text-slate-500">–ü—Ä–æ–≥—Ä–µ—Å</span>
                    <span id="prog-text" class="text-[10px] sm:text-xs font-black text-indigo-600">0/50</span>
                </div>
                <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                    <div id="prog-bar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 sm:p-8 space-y-10 custom-scrollbar pb-24 lg:pb-10" id="tasks-container">
            
            <section class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-[2rem] p-5 border border-amber-100">
                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                    <div class="text-4xl hidden sm:block">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                    <div class="flex-1 w-full">
                        <h2 class="text-lg font-bold text-amber-900 mb-2">–†–æ–∑–º–∏–Ω–∫–∞ –Ω–∞ —É–≤–∞–≥—É!</h2>
                        <p class="text-amber-800/80 text-sm leading-relaxed mb-4">
                            –ó–Ω–∞–π–¥–∏ ¬´–∑–∞–π–≤–µ¬ª —á–∏—Å–ª–æ —É —Ä—è–¥—É: <b>14, 21, 28, 34, 42, 49</b>.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-3 w-full">
                            <input type="number" id="logic-input" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ..." class="input-base sm:w-32">
                            <button onclick="checkLogicPuzzle()" class="w-full sm:w-auto px-6 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 transition active:scale-95">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                        </div>
                        <p id="logic-msg" class="text-sm font-bold mt-3 hidden"></p>
                    </div>
                </div>
            </section>

            <section class="space-y-5">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-3">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center text-lg font-black">1</div>
                    <h2 class="text-xl font-black text-slate-800">–ü—Ä–∞–≤–∏–ª–æ –∑–Ω–∞–∫—ñ–≤</h2>
                </div>
                
                <details class="bg-blue-50/60 rounded-2xl border border-blue-100 text-slate-700 overflow-hidden" open>
                    <summary class="cursor-pointer font-bold text-blue-900 p-4 bg-blue-100/50 hover:bg-blue-200/50 transition">
                        üìñ –®–ø–∞—Ä–≥–∞–ª–∫–∞: –Ø–∫ —Ä–æ–∑–∫—Ä–∏–≤–∞—Ç–∏ –¥—É–∂–∫–∏?
                    </summary>
                    <div class="p-5 text-sm space-y-3">
                        <p>üîπ –Ø–∫—â–æ –ø–µ—Ä–µ–¥ –¥—É–∂–∫–∞–º–∏ <b>¬´+¬ª</b> (–∞–±–æ –Ω—ñ—á–æ–≥–æ), –¥—É–∂–∫–∏ –ø—Ä–∏–±–∏—Ä–∞—î–º–æ, –∑–Ω–∞–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ <b>–∑–±–µ—Ä—ñ–≥–∞—î–º–æ</b>.</p>
                        <div class="bg-white p-2 rounded-lg text-center font-bold text-blue-700">+(a - b) = a - b</div>
                        <p>üî∏ –Ø–∫—â–æ –ø–µ—Ä–µ–¥ –¥—É–∂–∫–∞–º–∏ <b>¬´‚àí¬ª</b>, –¥—É–∂–∫–∏ –ø—Ä–∏–±–∏—Ä–∞—î–º–æ, –∞ –∑–Ω–∞–∫–∏ –í–°–Ü–• –¥–æ–¥–∞–Ω–∫—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ <b>–∑–º—ñ–Ω—é—î–º–æ –Ω–∞ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ</b>!</p>
                        <div class="bg-white p-2 rounded-lg text-center font-bold text-red-600">-(a - b) = -a + b</div>
                    </div>
                </details>

                <div id="block1-tasks" class="space-y-4"></div>
            </section>

            <section class="space-y-5">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-3 mt-8">
                    <div class="w-10 h-10 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center text-lg font-black">2</div>
                    <h2 class="text-xl font-black text-slate-800">–ß–∏—Å–ª–æ–≤—ñ –≤–∏—Ä–∞–∑–∏ (‚Ññ1111)</h2>
                </div>
                <p class="text-sm text-slate-500 px-2">–î–µ—Å—è—Ç–∫–æ–≤—ñ –¥—Ä–æ–±–∏ –≤–≤–æ–¥—å —á–µ—Ä–µ–∑ –∫—Ä–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: <b>1.5</b>).</p>
                <div id="block2-tasks" class="space-y-4"></div>
            </section>

            <section class="space-y-5">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-3 mt-8">
                    <div class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center text-lg font-black">3</div>
                    <h2 class="text-xl font-black text-slate-800">–ê–ª–≥–µ–±—Ä–∞ (‚Ññ1113, 1114)</h2>
                </div>
                <div id="block3-tasks" class="space-y-4"></div>
            </section>

            <section class="space-y-5">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-3 mt-8">
                    <div class="w-10 h-10 bg-pink-100 text-pink-600 rounded-xl flex items-center justify-center text-lg font-black">üéÆ</div>
                    <h2 class="text-xl font-black text-slate-800">–ó'—î–¥–Ω–∞–π –ø–∞—Ä–∏</h2>
                </div>
                <div class="bg-white p-4 sm:p-6 rounded-[2rem] border border-slate-200 shadow-sm" id="matching-game">
                    <p class="text-sm text-slate-500 mb-6">–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –≤–∏—Ä–∞–∑ –ª—ñ–≤–æ—Ä—É—á, –∞ –ø–æ—Ç—ñ–º –Ω–∞ –π–æ–≥–æ —Ä–æ–∑–∫—Ä–∏—Ç–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø—Ä–∞–≤–æ—Ä—É—á.</p>
                    <div class="flex gap-2 sm:gap-4" id="matching-container"></div>
                </div>
            </section>

            <section class="space-y-5">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-3 mt-8">
                    <div class="w-10 h-10 bg-rose-100 text-rose-600 rounded-xl flex items-center justify-center text-lg font-black">4</div>
                    <h2 class="text-xl font-black text-slate-800">–†—ñ–≤–Ω—è–Ω–Ω—è (‚Ññ1122, 1123)</h2>
                </div>
                <div id="block4-tasks" class="space-y-4"></div>
            </section>

            <div class="w-full h-px bg-slate-200 my-8"></div>

            <section class="space-y-5">
                <div class="flex items-center gap-3 border-b border-slate-100 pb-3">
                    <div class="text-3xl">üèÜ</div>
                    <h2 class="text-2xl font-black text-slate-800">–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</h2>
                </div>
                <div id="final-test" class="space-y-4"></div>
            </section>

            <div class="pt-8 text-center">
                <button onclick="finishLesson()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black text-lg hover:bg-indigo-600 transition-all active:scale-95 shadow-lg">
                    –ó–ê–í–ï–†–®–ò–¢–ò –£–†–û–ö
                </button>
            </div>
        </main>
    </div>

    <div id="panel-board" class="hidden lg:flex w-full lg:w-1/2 flex-col bg-slate-50 relative h-full">
        <div class="absolute top-4 left-1/2 -translate-x-1/2 z-40 flex items-center gap-1 sm:gap-2 bg-white p-2 rounded-2xl shadow-lg border border-slate-200">
            <button onclick="setTool('pen')" id="tool-pen" class="p-3 rounded-xl tool-active transition" title="–û–ª—ñ–≤–µ—Ü—å">‚úèÔ∏è</button>
            <button onclick="setTool('eraser')" id="tool-eraser" class="p-3 rounded-xl hover:bg-slate-100 transition" title="–ì—É–º–∫–∞">üßΩ</button>
            <div class="w-px h-8 bg-slate-200 mx-1"></div>
            <button onclick="toggleGrid()" id="tool-grid" class="px-3 py-2 text-xs font-bold text-slate-500 hover:bg-slate-100 rounded-xl transition hidden sm:block">üåê –°—ñ—Ç–∫–∞</button>
            <div class="w-px h-8 bg-slate-200 mx-1 hidden sm:block"></div>
            <button onclick="clearCanvas()" class="p-3 text-red-500 hover:bg-red-50 rounded-xl transition" title="–û—á–∏—Å—Ç–∏—Ç–∏">üóëÔ∏è</button>
        </div>
        <div class="canvas-container flex-1 bg-white lg:rounded-[2rem] lg:m-4 shadow-sm lg:border border-slate-200 overflow-hidden" id="canvas-wrap">
            <canvas id="whiteboard"></canvas>
        </div>
    </div>

    <div class="lg:hidden fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 flex z-50 shadow-[0_-10px_40px_rgba(0,0,0,0.05)] pb-safe">
        <button onclick="switchMobileTab('tasks')" id="tab-tasks" class="flex-1 py-4 text-sm font-bold border-t-4 mobile-tab-active flex flex-col items-center gap-1 transition-colors">
            <span class="text-lg">üìö</span> –ó–∞–≤–¥–∞–Ω–Ω—è
        </button>
        <button onclick="switchMobileTab('board')" id="tab-board" class="flex-1 py-4 text-sm font-bold border-t-4 border-transparent text-slate-500 flex flex-col items-center gap-1 transition-colors">
            <span class="text-lg">üñçÔ∏è</span> –î–æ—à–∫–∞
        </button>
    </div>

    <div id="result-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-8 max-w-sm w-full text-center shadow-2xl transform scale-95 transition-all" id="modal-content">
            <div class="text-6xl mb-4" id="res-emoji">üéØ</div>
            <h2 class="text-2xl font-black text-slate-800 mb-2">–Ü–Ω—Ç–µ–Ω—Å–∏–≤ –ó–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
            <div class="inline-block bg-indigo-50 border border-indigo-100 rounded-2xl px-6 py-3 mb-6">
                <p class="text-xs font-bold text-indigo-400 uppercase tracking-wide mb-1">–†–µ–∑—É–ª—å—Ç–∞—Ç</p>
                <p id="res-score" class="text-indigo-600 font-black text-4xl">0 / 50</p>
            </div>
            <p id="res-message" class="text-sm text-slate-600 mb-8 font-medium"></p>
            <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-indigo-600 transition active:scale-95">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑</button>
        </div>
    </div>

<script>
    let totalScore = 0; let answeredTasks = 0; const TOTAL_TASKS = 50; 

    function updateProgress() {
        answeredTasks++;
        document.getElementById('prog-text').innerText = `${answeredTasks}/${TOTAL_TASKS}`;
        document.getElementById('prog-bar').style.width = `${(answeredTasks / TOTAL_TASKS) * 100}%`;
    }

    function checkLogicPuzzle() {
        const inp = document.getElementById('logic-input');
        const msg = document.getElementById('logic-msg');
        if (parseInt(inp.value.trim()) === 34) {
            msg.innerText = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! 34 –Ω–µ –¥—ñ–ª–∏—Ç—å—Å—è –Ω–∞ 7 –±–µ–∑ –æ—Å—Ç–∞—á—ñ üéâ";
            msg.className = "text-sm font-bold mt-3 text-green-600 block";
            inp.classList.add('input-correct'); inp.disabled = true;
        } else {
            msg.innerText = "–°–ø—Ä–æ–±—É–π —â–µ! –ü–æ–¥–∏–≤–∏—Å—å –Ω–∞ –ø—ñ–¥–∫–∞–∑–∫—É.";
            msg.className = "text-sm font-bold mt-3 text-red-500 block";
            inp.classList.add('input-wrong'); setTimeout(() => inp.classList.remove('input-wrong'), 1000);
        }
    }

    // --- –ë–ê–ó–ê –î–ê–ù–ò–• (50 –∑–∞–≤–¥–∞–Ω—å) ---
    const b1 = [
        { t: 'mcq', q: "–†–æ–∑–∫—Ä–∏–π: \\( +(a - b) \\)", opts: ["\\( -a + b \\)", "\\( a - b \\)", "\\( -a - b \\)"], a: 1, h: "–ü–ª—é—Å –¥—É–∂–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—î.", s: "\\( a - b \\)", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'mcq', q: "–†–æ–∑–∫—Ä–∏–π: \\( -(x + y) \\)", opts: ["\\( -x - y \\)", "\\( x - y \\)", "\\( -x + y \\)"], a: 0, h: "–ú—ñ–Ω—É—Å –∑–º—ñ–Ω—é—î –≤—Å—ñ –∑–Ω–∞–∫–∏.", s: "\\( -x - y \\)", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'mcq', q: "–†–æ–∑–∫—Ä–∏–π: \\( -(-m + n) \\)", opts: ["\\( m - n \\)", "\\( -m - n \\)", "\\( m + n \\)"], a: 0, h: "–ó–º—ñ–Ω–∏ –∑–Ω–∞–∫ –±—ñ–ª—è m —Ç–∞ n.", s: "\\( m - n \\)", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( -(-15) \\)", a: 15, h: "–ú—ñ–Ω—É—Å –Ω–∞ –º—ñ–Ω—É—Å = –ø–ª—é—Å", s: "15", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( -(+7) \\)", a: -7, h: "–ú—ñ–Ω—É—Å –Ω–∞ –ø–ª—é—Å = –º—ñ–Ω—É—Å", s: "-7", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'mcq', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( a - (a + 5) \\)", opts: ["\\( 5 \\)", "\\( -5 \\)", "\\( 2a - 5 \\)"], a: 1, h: "a - a - 5", s: "-5", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'mcq', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( b + (10 - b) \\)", opts: ["\\( 10 \\)", "\\( 2b + 10 \\)", "\\( -10 \\)"], a: 0, h: "b + 10 - b", s: "10", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–ó–Ω–∞–π–¥–∏ –∑–Ω–∞—á–µ–Ω–Ω—è: \\( -(x - 3) \\), —è–∫—â–æ \\( x = 3 \\)", a: 0, h: "-(3 - 3)", s: "0", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'mcq', q: "–¢–æ—Ç–æ–∂–Ω–æ —Ä—ñ–≤–Ω–∏–π –≤–∏—Ä–∞–∑—É \\( c - d \\):", opts: ["\\( -(c + d) \\)", "\\( -(d - c) \\)"], a: 1, h: "–†–æ–∑–∫—Ä–∏–π –¥—Ä—É–≥–∏–π: -d + c = c - d", s: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: -(d - c)", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'mcq', q: "–†–æ–∑–∫—Ä–∏–π: \\( -( -(-x) ) \\)", opts: ["\\( -x \\)", "\\( x \\)"], a: 0, h: "–¢—Ä–∏ –º—ñ–Ω—É—Å–∏ = –º—ñ–Ω—É—Å.", s: "\\( -x \\)", l: "–°–∫–ª–∞–¥–Ω–∏–π" }
    ];

    const b2 = [
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏ (‚Ññ1111): \\( -(59 - 75) - (35 - 49) \\)", a: 30, h: "-(-16) - (-14)", s: "16 + 14 = 30", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( (82 - 9) - (8 + 32) \\)", a: 33, h: "73 - 40", s: "33", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( (4.9 - 5) - (2.9 - 4) \\)", a: 1, h: "-0.1 - (-1.1)", s: "1", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( -(0.8 - 3.2) - (-5.8 + 1.2) \\)", a: 7, h: "-(-2.4) - (-4.6)", s: "2.4 + 4.6 = 7", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( -(45 - 64) + (75 - 14) \\)", a: 80, h: "-(-19) + 61", s: "80", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( -(4.2 - 9.7) - (2.7 - 9) \\)", a: 11.8, h: "-(-5.5) - (-6.3)", s: "11.8", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( 15 - (10 - 5) \\)", a: 10, h: "15 - 5", s: "10", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( -(20 - 25) + 5 \\)", a: 10, h: "-(-5) + 5", s: "10", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏ –º–æ–¥—É–ª—å: \\( |-5| - (2 - 4) \\)", a: 7, h: "5 - (-2)", s: "7", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–û–±—á–∏—Å–ª–∏: \\( 1 - (1 - (1 - 2)) \\)", a: 1, h: "1 - 2 = -1; 1 - (-1) = 2; 1 - 2 = -1", s: "-1", l: "–°–∫–ª–∞–¥–Ω–∏–π" }
    ];

    const b3 = [
        { t: 'input', q: "–°–ø—Ä–æ—Å—Ç–∏ \\( 19 - (a + 7) \\). –Ø–∫–∏–π –í–Ü–õ–¨–ù–ò–ô –ß–õ–ï–ù (—á–∏—Å–ª–æ)?", a: 12, h: "19 - 7", s: "12", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–°–ø—Ä–æ—Å—Ç–∏ \\( -(4 - a + 2) - 28 \\). –ó–Ω–∞–π–¥–∏ –í–Ü–õ–¨–ù–ò–ô –ß–õ–ï–ù.", a: -34, h: "-4 - 2 - 28", s: "-34", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( b + (78 - b - 19) \\). –ó–Ω–∞–π–¥–∏ –≤–∏—Ä–∞–∑.", a: 59, h: "b –∑–Ω–∏—â–∏—Ç—å—Å—è. 78 - 19", s: "59", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( -24 - (16 - x) \\). –Ø–∫–∏–π –í–Ü–õ–¨–ù–ò–ô –ß–õ–ï–ù?", a: -40, h: "-24 - 16", s: "-40", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( 11 - (22 + y - 15) \\). –í–Ü–õ–¨–ù–ò–ô –ß–õ–ï–ù?", a: 4, h: "11 - 22 + 15", s: "4", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'mcq', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( -(a + 50) - (-a - 50) \\)", opts: ["\\( 0 \\)", "\\( -100 \\)", "\\( -2a \\)"], a: 0, h: "-a - 50 + a + 50", s: "0", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–ó–Ω–∞–π–¥–∏ –∑–Ω–∞—á–µ–Ω–Ω—è: \\( a - (b - c) \\), —è–∫—â–æ a=5, b=2, c=-3", a: 0, h: "5 - (2 - (-3)) = 5 - 5", s: "0", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'mcq', q: "–°–ø—Ä–æ—Å—Ç–∏: \\( x - (x - (x - 1)) \\)", opts: ["\\( x - 1 \\)", "\\( -x + 1 \\)"], a: 0, h: "–ô–¥–∏ –∑—Å–µ—Ä–µ–¥–∏–Ω–∏.", s: "\\( x - 1 \\)", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –±—ñ–ª—è \\( x \\): \\( 5x - (2x - 1) + x \\)", a: 4, h: "5x - 2x + x", s: "4", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'mcq', q: "–í—ñ–∑—å–º–∏ –≤ –¥—É–∂–∫–∏ –∑ –º—ñ–Ω—É—Å–æ–º –ø–æ–ø–µ—Ä–µ–¥—É: \\( -5 + 2 \\)", opts: ["\\( -(5 - 2) \\)", "\\( -(5 + 2) \\)"], a: 0, h: "–ó–Ω–∞–∫–∏ –º—ñ–Ω—è—é—Ç—å—Å—è: -5 —Å—Ç–∞—î 5, +2 —Å—Ç–∞—î -2.", s: "\\( -(5 - 2) \\)", l: "–°–∫–ª–∞–¥–Ω–∏–π" }
    ];

    const b4 = [
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( 4.8 - (5.8 + x) = 1.2 \\)", a: -2.2, h: "4.8 - 5.8 - x = 1.2", s: "-1 - x = 1.2", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( (x + 7.2) - 14 = -2.3 \\)", a: 4.5, h: "x - 6.8 = -2.3", s: "x = 4.5", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( -9 + (14.7 - x) = 1.3 \\)", a: 4.4, h: "5.7 - x = 1.3", s: "x = 4.4", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( -(x - 1.9) - 1.5 = 0.15 \\)", a: 0.25, h: "-x + 1.9 - 1.5 = 0.15", s: "-x + 0.4 = 0.15", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( 8.3 - (-3.2 + x) = 12 \\)", a: -0.5, h: "8.3 + 3.2 - x = 12", s: "11.5 - x = 12", l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( x - (2 - x) = 8 \\)", a: 5, h: "x - 2 + x = 8", s: "2x = 10", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( 10 - (x + 3) = 5 \\)", a: 2, h: "10 - x - 3 = 5", s: "x = 2", l: "–õ–µ–≥–∫–∏–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( (2x + 1) - (x - 4) = 10 \\)", a: 5, h: "2x + 1 - x + 4 = 10", s: "x = 5", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( -(x - 5) = -2 \\)", a: 7, h: "-x + 5 = -2", s: "x = 7", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { t: 'input', q: "–†–æ–∑–≤'—è–∂–∏: \\( 5x - (4x + 1) = 9 \\)", a: 10, h: "5x - 4x - 1 = 9", s: "x - 1 = 9", l: "–°–µ—Ä–µ–¥–Ω—ñ–π" }
    ];

    const testData = [
        { q: "–Ø–∫—â–æ –ø–µ—Ä–µ–¥ –¥—É–∂–∫–∞–º–∏ –º—ñ–Ω—É—Å, —Ç–æ...", opts: ["–ó–Ω–∞–∫–∏ –Ω–µ –º—ñ–Ω—è—é—Ç—å—Å—è", "–ó–Ω–∞–∫–∏ –º—ñ–Ω—è—é—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ"], a: 1, l: "–õ–µ–≥–∫–∏–π" },
        { q: "–°–ø—Ä–æ—Å—Ç–∏: \\( -a - (b - a) \\)", opts: ["\\( -b \\)", "\\( -2a - b \\)"], a: 0, l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–†—ñ–≤–Ω—è–Ω–Ω—è: \\( 5 - (x + 2) = 0 \\)", opts: ["3", "-3"], a: 0, l: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–°–ø—Ä–æ—Å—Ç–∏: \\( (x - y) - (x + y) \\)", opts: ["\\( -2y \\)", "\\( 0 \\)"], a: 0, l: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { q: "–Ø–∫–∏–π –≤–∏—Ä–∞–∑ –¥–æ—Ä—ñ–≤–Ω—é—î \\( x + y - z \\)?", opts: ["\\( x - (z - y) \\)", "\\( x - (y + z) \\)"], a: 0, l: "–°–∫–ª–∞–¥–Ω–∏–π" }
    ];

    let taskStates = new Array(60).fill(false);
    let currentGlobalId = 0;

    const matchPairs = [
        { id: 0, l: "\\( -(x - 5) \\)", r: "\\( -x + 5 \\)" },
        { id: 1, l: "\\( +(x - 5) \\)", r: "\\( x - 5 \\)" },
        { id: 2, l: "\\( -(-x - 5) \\)", r: "\\( x + 5 \\)" },
        { id: 3, l: "\\( -x - (5 - x) \\)", r: "\\( -5 \\)" },
        { id: 4, l: "\\( x - (x - 5) \\)", r: "\\( 5 \\)" }
    ];
    let selectedLeft = null; let matchesFound = 0;
    const matchColors = ['bg-green-100 border-green-400 text-green-800', 'bg-yellow-100 border-yellow-400 text-yellow-800', 'bg-blue-100 border-blue-400 text-blue-800', 'bg-pink-100 border-pink-400 text-pink-800', 'bg-purple-100 border-purple-400 text-purple-800'];

    // --- –§–£–ù–ö–¶–Ü–á –†–ï–ù–î–ï–†–£ ---
    window.onload = () => {
        renderTasks('block1-tasks', b1); renderTasks('block2-tasks', b2);
        renderTasks('block3-tasks', b3); renderGame();
        renderTasks('block4-tasks', b4); renderTest();
        
        // –ë–µ–∑–ø–µ—á–Ω–∏–π –≤–∏–∫–ª–∏–∫ MathJax
        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise().catch(err => console.log(err));
        }
        setTimeout(resizeCanvas, 300);
    };

    function renderTasks(containerId, dataArr) {
        const container = document.getElementById(containerId); let html = '';
        dataArr.forEach(task => {
            let id = currentGlobalId++;
            let badgeColor = task.l === '–õ–µ–≥–∫–∏–π' ? 'bg-green-100 text-green-700' : task.l === '–°–µ—Ä–µ–¥–Ω—ñ–π' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700';
            
            html += `<div class="task-card bg-white p-4 sm:p-6 rounded-3xl" id="task-${id}">
                <div class="flex justify-between mb-3"><span class="px-2 py-1 rounded-lg text-[10px] font-bold uppercase ${badgeColor}">${task.l}</span></div>
                <h3 class="text-sm sm:text-base font-bold text-slate-800 mb-4">${task.q}</h3>`;

            if(task.t === 'input') {
                html += `<div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="input-${id}" class="input-base" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å...">
                    <button onclick="checkInput(${id}, ${task.a})" id="btn-${id}" class="px-6 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-indigo-600 transition active:scale-95">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                </div>`;
            } else {
                let optsHTML = task.opts.map((opt, oIdx) => `<button id="mcqbtn-${id}-${oIdx}" onclick="checkMCQ(${id}, ${oIdx}, ${task.a})" class="option-btn w-full text-left p-3 rounded-xl border-2 border-slate-100 bg-slate-50 font-medium text-slate-700 flex items-center gap-3 mb-2"><div class="w-5 h-5 rounded-full border-2 border-slate-300 shrink-0" id="mcqcircle-${id}-${oIdx}"></div><span class="text-sm sm:text-base">${opt}</span></button>`).join('');
                html += `<div>${optsHTML}</div>`;
            }

            html += `<div class="flex justify-between items-center mt-4 pt-3 border-t border-slate-50">
                <button onclick="document.getElementById('hint-${id}').classList.toggle('hidden')" class="text-xs font-bold text-slate-400 hover:text-indigo-500 uppercase">üí° –ü—ñ–¥–∫–∞–∑–∫–∞</button>
                <button onclick="document.getElementById('sol-${id}').classList.toggle('hidden')" class="text-xs font-bold text-slate-400 hover:text-indigo-500 uppercase">–†—ñ—à–µ–Ω–Ω—è üëÅÔ∏è</button>
            </div>
            <div id="hint-${id}" class="hidden mt-3 p-3 bg-yellow-50 rounded-xl text-xs sm:text-sm text-yellow-800">${task.h}</div>
            <div id="sol-${id}" class="hidden mt-3 p-3 bg-indigo-50 rounded-xl text-xs sm:text-sm text-indigo-800">${task.s}</div></div>`;
        });
        container.innerHTML = html;
    }

    function renderTest() {
        const container = document.getElementById('final-test'); let html = '';
        testData.forEach((task) => {
            let id = currentGlobalId++;
            let optsHTML = task.opts.map((opt, oIdx) => `<button id="mcqbtn-${id}-${oIdx}" onclick="checkMCQ(${id}, ${oIdx}, ${task.a})" class="option-btn w-full text-left p-4 rounded-2xl border-2 border-slate-100 bg-slate-50 font-medium flex items-center gap-3 mb-2"><div class="w-5 h-5 rounded-full border-2 border-slate-300 shrink-0" id="mcqcircle-${id}-${oIdx}"></div><span class="text-sm sm:text-base">${opt}</span></button>`).join('');
            html += `<div class="task-card bg-white p-5 rounded-3xl"><h3 class="font-bold mb-4">${task.q}</h3><div>${optsHTML}</div></div>`;
        });
        container.innerHTML = html;
    }

    function checkInput(id, correctAns) {
        if(taskStates[id]) return;
        const inp = document.getElementById(`input-${id}`); const btn = document.getElementById(`btn-${id}`);
        const userVal = parseFloat(inp.value.replace(',', '.'));
        if(isNaN(userVal)) { alert("–í–≤–µ–¥–∏ —á–∏—Å–ª–æ!"); return; }
        if(userVal === correctAns) {
            inp.classList.add('input-correct'); inp.disabled = true;
            btn.innerHTML = "‚úì"; btn.classList.replace('bg-slate-900', 'bg-green-600'); btn.disabled = true;
            totalScore++; taskStates[id] = true; updateProgress();
        } else {
            inp.classList.add('input-wrong'); setTimeout(() => inp.classList.remove('input-wrong'), 1000);
        }
    }

    function checkMCQ(id, userOpt, correctOpt) {
        if(taskStates[id]) return;
        const selectedBtn = document.getElementById(`mcqbtn-${id}-${userOpt}`); const selectedCircle = document.getElementById(`mcqcircle-${id}-${userOpt}`);
        const correctBtn = document.getElementById(`mcqbtn-${id}-${correctOpt}`); const correctCircle = document.getElementById(`mcqcircle-${id}-${correctOpt}`);
        let i = 0; while(document.getElementById(`mcqbtn-${id}-${i}`)) { document.getElementById(`mcqbtn-${id}-${i}`).disabled = true; document.getElementById(`mcqbtn-${id}-${i}`).classList.add('opacity-50'); i++; }
        if(userOpt === correctOpt) {
            selectedBtn.classList.add('option-correct', 'opacity-100'); selectedCircle.innerHTML = '<div class="w-2 h-2 bg-green-600 rounded-full m-auto mt-1"></div>'; selectedCircle.classList.add('border-green-600');
            totalScore++;
        } else {
            selectedBtn.classList.add('option-wrong', 'opacity-100'); selectedCircle.innerHTML = '<div class="w-2 h-2 bg-red-600 rounded-full m-auto mt-1"></div>';
            correctBtn.classList.add('option-correct', 'opacity-100'); correctCircle.innerHTML = '<div class="w-2 h-2 bg-green-600 rounded-full m-auto mt-1"></div>';
        }
        taskStates[id] = true; updateProgress();
    }

    function renderGame() {
        const container = document.getElementById('matching-container');
        let lefts = [...matchPairs]; let rights = [...matchPairs].sort(() => Math.random() - 0.5);
        let leftHTML = lefts.map(p => `<button id="m-left-${p.id}" onclick="selectL(${p.id})" class="match-btn w-full mb-2">${p.l}</button>`).join('');
        let rightHTML = rights.map(p => `<button id="m-right-${p.id}" onclick="selectR(${p.id})" class="match-btn w-full mb-2">${p.r}</button>`).join('');
        container.innerHTML = `<div class="w-1/2">${leftHTML}</div><div class="w-1/2">${rightHTML}</div>`;
    }

    function selectL(id) {
        if(document.getElementById(`m-left-${id}`).disabled) return;
        matchPairs.forEach(p => { let el = document.getElementById(`m-left-${p.id}`); if(!el.disabled) el.classList.remove('match-selected'); });
        selectedLeft = id; document.getElementById(`m-left-${id}`).classList.add('match-selected');
    }

    function selectR(id) {
        if(selectedLeft === null || document.getElementById(`m-right-${id}`).disabled) return;
        const lEl = document.getElementById(`m-left-${selectedLeft}`); const rEl = document.getElementById(`m-right-${id}`);
        if(selectedLeft === id) {
            lEl.classList.remove('match-selected');
            let cClass = matchColors[matchesFound % matchColors.length];
            cClass.split(' ').forEach(cls => { lEl.classList.add(cls); rEl.classList.add(cls); });
            lEl.disabled = true; rEl.disabled = true;
            matchesFound++; totalScore++; updateProgress(); selectedLeft = null;
        } else {
            rEl.classList.add('match-wrong'); setTimeout(() => rEl.classList.remove('match-wrong'), 400);
        }
    }

    function finishLesson() {
        const modal = document.getElementById('result-modal'); document.getElementById('res-score').innerText = `${totalScore} / ${TOTAL_TASKS}`;
        const msg = document.getElementById('res-message'); const emoji = document.getElementById('res-emoji');
        let p = totalScore / TOTAL_TASKS;
        if (p >= 0.85) { emoji.innerText = "üèÜ"; msg.innerText = "–Ü–¥–µ–∞–ª—å–Ω–æ! –¢–∏ –º–∞–π—Å—Ç–µ—Ä —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è –¥—É–∂–æ–∫."; } 
        else if (p >= 0.5) { emoji.innerText = "üëç"; msg.innerText = "–î–æ–±—Ä–µ! –¢—Ä–µ–±–∞ —â–µ —Ç—Ä–æ—Ö–∏ —É–≤–∞–∂–Ω–æ—Å—Ç—ñ –∑—ñ –∑–Ω–∞–∫–∞–º–∏."; } 
        else { emoji.innerText = "üí™"; msg.innerText = "–ù–µ –∑–¥–∞–≤–∞–π—Å—è! –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –ª—é–±–∏—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É."; }
        modal.classList.remove('hidden'); setTimeout(() => document.getElementById('modal-content').classList.remove('scale-95'), 10);
    }

    // --- –ú–û–ë–Ü–õ–¨–ù–ï –ú–ï–ù–Æ ---
    function switchMobileTab(tab) {
        const pTasks = document.getElementById('panel-tasks'); const pBoard = document.getElementById('panel-board');
        const tTasks = document.getElementById('tab-tasks'); const tBoard = document.getElementById('tab-board');
        if(tab === 'tasks') {
            pTasks.classList.remove('hidden'); pTasks.classList.add('flex'); pBoard.classList.add('hidden'); pBoard.classList.remove('flex');
            tTasks.classList.add('mobile-tab-active'); tTasks.classList.remove('border-transparent', 'text-slate-500');
            tBoard.classList.remove('mobile-tab-active'); tBoard.classList.add('border-transparent', 'text-slate-500');
        } else {
            pTasks.classList.add('hidden'); pTasks.classList.remove('flex'); pBoard.classList.remove('hidden'); pBoard.classList.add('flex');
            tBoard.classList.add('mobile-tab-active'); tBoard.classList.remove('border-transparent', 'text-slate-500');
            tTasks.classList.remove('mobile-tab-active'); tTasks.classList.add('border-transparent', 'text-slate-500');
            setTimeout(resizeCanvas, 50);
        }
    }

    // --- WHITEBOARD ---
    const canvas = document.getElementById('whiteboard'); const ctx = canvas.getContext('2d'); const containerWrap = document.getElementById('canvas-wrap');
    let isDrawing = false; let currentTool = 'pen'; let showGrid = false;

    function resizeCanvas() {
        if(containerWrap.clientWidth === 0) return;
        canvas.width = containerWrap.clientWidth; canvas.height = containerWrap.clientHeight; redrawCanvas();
    }
    function redrawCanvas() { ctx.lineCap = 'round'; ctx.lineJoin = 'round'; if (showGrid) drawGrid(); }
    function setTool(tool) {
        currentTool = tool; document.getElementById('tool-pen').classList.toggle('tool-active', tool === 'pen'); document.getElementById('tool-eraser').classList.toggle('tool-active', tool === 'eraser');
    }
    function getMousePos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX || (e.touches && e.touches.length > 0 ? e.touches[0].clientX : 0);
        const clientY = e.clientY || (e.touches && e.touches.length > 0 ? e.touches[0].clientY : 0);
        return { x: clientX - rect.left, y: clientY - rect.top };
    }
    function startPosition(e) { isDrawing = true; draw(e); }
    function endPosition() { isDrawing = false; ctx.beginPath(); }
    function draw(e) {
        if (!isDrawing) return; e.preventDefault();
        const pos = getMousePos(e); ctx.lineWidth = currentTool === 'eraser' ? 30 : 3; ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : '#1e293b';
        ctx.lineTo(pos.x, pos.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(pos.x, pos.y);
    }
    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); if (showGrid) drawGrid(); }
    function toggleGrid() {
        showGrid = !showGrid; const btn = document.getElementById('tool-grid');
        if (showGrid) { btn.classList.add('bg-slate-200', 'text-indigo-600'); drawGrid(); } else { btn.classList.remove('bg-slate-200', 'text-indigo-600'); ctx.clearRect(0, 0, canvas.width, canvas.height); }
    }
    function drawGrid() {
        ctx.save(); ctx.strokeStyle = '#f1f5f9'; ctx.lineWidth = 1; const step = 40; ctx.beginPath();
        for(let x=0; x<=canvas.width; x+=step) { ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); }
        for(let y=0; y<=canvas.height; y+=step) { ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); }
        ctx.stroke(); ctx.restore();
    }
    canvas.addEventListener('mousedown', startPosition); canvas.addEventListener('mouseup', endPosition);
    canvas.addEventListener('mousemove', draw); canvas.addEventListener('mouseout', endPosition);
    canvas.addEventListener('touchstart', startPosition, { passive: false }); canvas.addEventListener('touchend', endPosition); canvas.addEventListener('touchmove', draw, { passive: false });
    window.addEventListener('resize', resizeCanvas);

</script>
</body>
</html>
