<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sofiia | Tutor Dashboard 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .grid-week { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; }
        @media (max-width: 768px) { .grid-week { grid-template-columns: 1fr; } }
        .slot-free { background-color: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; }
        .slot-busy { background-color: #f3f4f6; border: 1px solid #e5e7eb; color: #9ca3af; }
    </style>
</head>
<body class="bg-slate-50 p-4 md:p-8 text-gray-800">

    <div class="max-w-6xl mx-auto">
        <nav class="flex justify-center gap-2 sm:gap-4 mb-10">
            <button onclick="showTab('public', this)" class="tab-btn bg-indigo-600 text-white px-6 py-2 rounded-2xl shadow-md font-semibold transition">–í—ñ–∫–æ–Ω—Ü—è</button>
            <button onclick="showTab('private', this)" class="tab-btn bg-white text-indigo-600 px-6 py-2 rounded-2xl shadow-sm border font-semibold transition">–ú—ñ–π —Ä–æ–∑–∫–ª–∞–¥</button>
            <button onclick="showTab('log', this)" class="tab-btn bg-white text-indigo-600 px-6 py-2 rounded-2xl shadow-sm border font-semibold transition">–ñ—É—Ä–Ω–∞–ª</button>
        </nav>

        <div id="public" class="tab-content block">
            <div class="bg-white p-8 rounded-[2rem] shadow-xl border border-indigo-50">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-slate-900">–ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å ‚ú®</h2>
                    <button onclick="copyFreeHours()" id="copyBtn" class="bg-indigo-600 text-white px-5 py-2 rounded-xl text-sm font-bold hover:bg-indigo-700 shadow-lg transition">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º üìã</button>
                </div>
                <div id="public-week" class="grid-week">
                    </div>
            </div>
        </div>

        <div id="private" class="tab-content hidden">
            <div class="bg-white p-8 rounded-[2rem] shadow-xl border border-slate-100">
                <h2 class="text-3xl font-bold text-slate-900 mb-8">–ú—ñ–π —Ä–æ–±–æ—á–∏–π —Ç–∏–∂–¥–µ–Ω—å</h2>
                <div id="private-week" class="grid-week">
                    </div>
            </div>
        </div>

        <div id="log" class="tab-content hidden">
            <div class="bg-white rounded-[2rem] shadow-xl border border-slate-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 text-slate-500 text-xs font-bold uppercase tracking-wider">
                        <tr>
                            <th class="p-6">–î–∞—Ç–∞</th>
                            <th class="p-6">–£—á–µ–Ω—å</th>
                            <th class="p-6">–¢–µ–º–∞ –∑–∞–Ω—è—Ç—Ç—è</th>
                            <th class="p-6 text-center">–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                        </tr>
                    </thead>
                    <tbody id="log-body" class="divide-y divide-slate-100">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQgrwL7j8Mlat4GqhSWe9xAivXD_PzWZ0TRedmHRgVuv_x6Hv7J_Kf4B8duzcN6asmBwCureC2q8toG/pub?output=csv";
        const DAYS = ["–ü–æ–Ω–µ–¥—ñ–ª–æ–∫", "–í—ñ–≤—Ç–æ—Ä–æ–∫", "–°–µ—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä", "–ü'—è—Ç–Ω–∏—Ü—è"];
        let freeSlotsText = "";

        function showTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.replace('block', 'hidden'));
            document.getElementById(tabId).classList.replace('hidden', 'block');
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.replace('bg-indigo-600', 'bg-white');
                b.classList.replace('text-white', 'text-indigo-600');
            });
            btn.classList.replace('bg-white', 'bg-indigo-600');
            btn.classList.replace('text-white', 'text-white');
        }

        async function loadData() {
            try {
                const response = await fetch(SHEET_URL);
                const csvText = await response.text();
                const separator = csvText.split('\n')[0].includes(';') ? ';' : ',';
                const rows = csvText.split('\n').slice(1).filter(r => r.trim());

                const dataByDay = { "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫": [], "–í—ñ–≤—Ç–æ—Ä–æ–∫": [], "–°–µ—Ä–µ–¥–∞": [], "–ß–µ—Ç–≤–µ—Ä": [], "–ü'—è—Ç–Ω–∏—Ü—è": [] };

                rows.forEach(line => {
                    const col = line.split(separator).map(c => c.replace(/^"|"$/g, '').trim());
                    const dayName = col[0].split(' ')[0]; // –û—Ç—Ä–∏–º—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –Ω–∞–∑–≤—É –¥–Ω—è
                    if (dataByDay[dayName]) {
                        dataByDay[dayName].push({
                            time: col[1], student: col[2], subject: col[3],
                            link: col[4], status: col[5], topic: col[6], grade: col[8]
                        });
                    }
                });

                renderPublic(dataByDay);
                renderPrivate(dataByDay);
                renderLog(rows, separator);

            } catch (err) { console.error("–ü–æ–º–∏–ª–∫–∞:", err); }
        }

        function renderPublic(data) {
            const container = document.getElementById('public-week');
            container.innerHTML = '';
            let copyText = "–í—ñ–ª—å–Ω—ñ –≤—ñ–∫–æ–Ω—Ü—è –¥–ª—è –∑–∞–ø–∏—Å—É:\n";

            DAYS.forEach(day => {
                let dayHtml = `<div class="flex flex-col gap-3"><h3 class="font-bold text-center text-slate-400 mb-2">${day}</h3>`;
                data[day].forEach(slot => {
                    const hour = parseInt(slot.time);
                    if (hour < 16 && !slot.student.includes("–í—Å–µ–≤–æ–ª–æ–¥")) return;

                    const isFree = slot.status.toLowerCase().includes('–≤—ñ–ª—å–Ω–æ');
                    const cssClass = isFree ? 'slot-free font-bold' : 'slot-busy text-xs';
                    dayHtml += `<div class="${cssClass} p-3 rounded-xl text-center shadow-sm">${slot.time} ${isFree ? '' : '(–ó–∞–π–Ω—è—Ç–æ)'}</div>`;
                    if (isFree) copyText += `‚Ä¢ ${day}: ${slot.time}\n`;
                });
                dayHtml += `</div>`;
                container.innerHTML += dayHtml;
            });
            freeSlotsText = copyText;
        }

        function renderPrivate(data) {
            const container = document.getElementById('private-week');
            container.innerHTML = '';

            DAYS.forEach(day => {
                let dayHtml = `<div class="flex flex-col gap-4"><h3 class="font-bold text-center text-indigo-900 mb-2 bg-indigo-50 py-2 rounded-xl">${day}</h3>`;
                data[day].forEach(slot => {
                    if (!slot.student || slot.status.toLowerCase().includes('–≤—ñ–ª—å–Ω–æ')) return;

                    const meetLink = slot.link.includes('http') ? slot.link : 'https://meet.google.com';
                    dayHtml += `
                        <div class="bg-white p-4 rounded-2xl border-l-4 border-indigo-500 shadow-sm hover:shadow-md transition">
                            <div class="text-[10px] font-bold text-slate-400">${slot.time}</div>
                            <div class="font-bold text-slate-800 mb-3">${slot.student}</div>
                            <a href="${meetLink}" target="_blank" class="block text-center bg-slate-900 text-white py-2 rounded-lg text-xs font-semibold hover:bg-indigo-600 transition">–£—Ä–æ–∫ ‚Æï</a>
                        </div>`;
                });
                dayHtml += `</div>`;
                container.innerHTML += dayHtml;
            });
        }

        function renderLog(rows, sep) {
            const body = document.getElementById('log-body');
            body.innerHTML = '';
            rows.forEach(line => {
                const col = line.split(sep).map(c => c.replace(/^"|"$/g, '').trim());
                if (!col[6] || col[6] === '-') return;
                body.innerHTML += `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="p-6 text-slate-400 text-xs">${col[0]}</td>
                        <td class="p-6 font-bold text-slate-700">${col[2]}</td>
                        <td class="p-6 text-slate-600 italic">${col[6]}</td>
                        <td class="p-6 text-center"><span class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full font-bold text-xs">${col[8] || '-'}</span></td>
                    </tr>`;
            });
        }

        function copyFreeHours() {
            navigator.clipboard.writeText(freeSlotsText).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.innerText = "–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! ‚úÖ";
                setTimeout(() => btn.innerText = "–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º üìã", 2000);
            });
        }

        loadData();
    </script>
</body>
</html>
