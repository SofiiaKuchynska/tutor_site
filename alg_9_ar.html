<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9 –∫–ª–∞—Å: –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—ñ—è (–ü–æ–≤–Ω–∏–π –∫—É—Ä—Å)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .task-card { border: 1px solid #e2e8f0; transition: all 0.3s ease; }
        .task-card:hover { border-color: #3b82f6; box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1); transform: translateY(-2px); }
        
        .input-base {
            width: 100%; padding: 0.75rem 1rem; border-radius: 0.75rem; border: 2px solid #e2e8f0; 
            background-color: #f8fafc; font-weight: 600; color: #1e293b; outline: none; transition: all 0.2s;
        }
        .input-base:focus { border-color: #6366f1; background-color: #ffffff; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .input-correct { border-color: #22c55e !important; background-color: #dcfce7 !important; color: #166534 !important; }
        .input-wrong { border-color: #ef4444 !important; background-color: #fee2e2 !important; color: #991b1b !important; }
        
        .canvas-container { position: relative; background: #ffffff; cursor: crosshair; touch-action: none; }
        .tool-active { background-color: #4f46e5; color: #ffffff; box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4); }
        
        .option-btn { transition: all 0.2s; }
        .option-btn:hover:not(:disabled) { background-color: #f1f5f9; border-color: #94a3b8; }
        .option-correct { background-color: #dcfce7 !important; border-color: #22c55e !important; color: #166534 !important; }
        .option-wrong { background-color: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b !important; }
    </style>
</head>
<body class="h-screen flex text-slate-900">

    <div class="w-full lg:w-1/2 flex flex-col bg-white border-r border-slate-200 shadow-xl z-10 relative">
        <header class="p-5 border-b border-slate-100 flex justify-between items-center bg-white/95 backdrop-blur-md sticky top-0 z-30">
            <div>
                <h1 class="text-2xl font-extrabold tracking-tight text-slate-800">–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—ñ—è</h1>
                <p class="text-[11px] font-bold text-indigo-500 uppercase tracking-widest mt-1">9 –ö–ª–∞—Å ‚Ä¢ –Ü–Ω—Ç–µ–Ω—Å–∏–≤ ‚Ä¢ 40 –ó–∞–≤–¥–∞–Ω—å</p>
            </div>
            <div class="flex flex-col items-end w-32">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-xs font-bold text-slate-500">–ü—Ä–æ–≥—Ä–µ—Å</span>
                    <span id="prog-text" class="text-xs font-black text-indigo-600">0/40</span>
                </div>
                <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                    <div id="prog-bar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6 lg:p-10 space-y-10 custom-scrollbar pb-32">
            
            <section class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-3xl p-6 border border-amber-100">
                <div class="flex items-start gap-4">
                    <div class="text-4xl">üß†</div>
                    <div class="flex-1">
                        <h2 class="text-xl font-bold text-amber-900 mb-2">–õ–æ–≥—ñ—á–Ω–∞ —Ä–æ–∑–º–∏–Ω–∫–∞</h2>
                        <p class="text-amber-800/80 text-sm leading-relaxed mb-4">
                            –ó–Ω–∞–π–¥–∏ –∑–∞–∫–æ–Ω–æ–º—ñ—Ä–Ω—ñ—Å—Ç—å: <b>–°, –õ, –ë, –ö, –¢, ...</b> –Ø–∫–∞ –Ω–∞—Å—Ç—É–ø–Ω–∞ –ª—ñ—Ç–µ—Ä–∞?
                        </p>
                        <div class="flex gap-3">
                            <input type="text" id="logic-input" placeholder="1 –ª—ñ—Ç–µ—Ä–∞..." class="input-base !w-auto" maxlength="1">
                            <button onclick="checkLogicPuzzle()" class="px-6 py-2 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 transition shadow-md active:scale-95">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                        </div>
                        <p id="logic-msg" class="text-sm font-bold mt-3 hidden"></p>
                        <details class="mt-3 group">
                            <summary class="cursor-pointer text-xs text-amber-600 font-semibold opacity-70 hover:opacity-100">–ü—ñ–¥–∫–∞–∑–∫–∞</summary>
                            <p class="text-xs text-amber-800 mt-2 bg-amber-100/50 p-3 rounded-lg">–ó–≥–∞–¥–∞–π –º—ñ—Å—è—Ü—ñ —Ä–æ–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é... üòâ</p>
                        </details>
                    </div>
                </div>
            </section>

            <section class="space-y-6">
                <div class="flex items-center gap-4 border-b border-slate-100 pb-4">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center text-xl shadow-inner shadow-blue-200">1Ô∏è‚É£</div>
                    <h2 class="text-2xl font-black text-slate-800">–†–æ–∑–º–∏–Ω–∫–∞: –ó–≤–∏—á–∞–π–Ω—ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ</h2>
                </div>
                <div id="block1-tasks" class="space-y-5"></div>
            </section>

            <section class="space-y-6">
                <div class="flex items-center gap-4 border-b border-slate-100 pb-4 mt-8">
                    <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center text-xl shadow-inner shadow-purple-200">2Ô∏è‚É£</div>
                    <h2 class="text-2xl font-black text-slate-800">–ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ä—ñ–∑–Ω–∏—Ü—é \( d \)</h2>
                </div>
                <div class="bg-purple-50/50 p-5 rounded-2xl text-slate-700 text-sm leading-relaxed border border-purple-100 shadow-sm">
                    <p class="mb-2"><b class="text-purple-700">–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—ñ—è</b> ‚Äî —Ü–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å, –¥–µ –∫–æ–∂–Ω–µ –Ω–∞—Å—Ç—É–ø–Ω–µ —á–∏—Å–ª–æ —É—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º —Ä—ñ–∑–Ω–∏—Ü—ñ \( d \).</p>
                    <div class="bg-white p-4 rounded-xl border border-purple-200 text-center my-3 shadow-sm">
                        <p class="font-bold text-slate-800">–§–æ—Ä–º—É–ª–∞ —Ä—ñ–∑–Ω–∏—Ü—ñ:</p>
                        <p class="text-xl text-purple-600 my-1 font-black">\( d = a_{n+1} - a_n \)</p>
                    </div>
                </div>
                <div id="block2-tasks" class="space-y-5"></div>
            </section>

            <section class="space-y-6">
                <div class="flex items-center gap-4 border-b border-slate-100 pb-4 mt-8">
                    <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-2xl flex items-center justify-center text-xl shadow-inner shadow-emerald-200">3Ô∏è‚É£</div>
                    <h2 class="text-2xl font-black text-slate-800">–§–æ—Ä–º—É–ª–∞ \( n \)-–≥–æ —á–ª–µ–Ω–∞</h2>
                </div>
                <div class="bg-emerald-50/50 p-5 rounded-2xl text-slate-700 text-sm leading-relaxed border border-emerald-100 shadow-sm">
                    <div class="bg-white p-4 rounded-xl border border-emerald-200 text-center shadow-sm">
                        <p class="text-2xl text-emerald-600 font-black">\( a_n = a_1 + d(n - 1) \)</p>
                    </div>
                </div>
                <div id="block3-tasks" class="space-y-5"></div>
            </section>

            <section class="space-y-6">
                <div class="flex items-center gap-4 border-b border-slate-100 pb-4 mt-8">
                    <div class="w-12 h-12 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center text-xl shadow-inner shadow-rose-200">4Ô∏è‚É£</div>
                    <h2 class="text-2xl font-black text-slate-800">–†—ñ–≤–Ω—è–Ω–Ω—è —Ç–∞ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ</h2>
                </div>
                <div class="bg-rose-50/50 p-5 rounded-2xl text-slate-700 text-sm leading-relaxed border border-rose-100 shadow-sm">
                    <p>–¢—É—Ç —Ç—Ä–µ–±–∞ –∑–Ω–∞–π—Ç–∏ –Ω–æ–º–µ—Ä \( n \), –∞–±–æ –ø–µ—Ä—à–∏–π —á–ª–µ–Ω \( a_1 \). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç—É —Å–∞–º—É —Ñ–æ—Ä–º—É–ª—É —è–∫ –∑–≤–∏—á–∞–π–Ω–µ —Ä—ñ–≤–Ω—è–Ω–Ω—è!</p>
                </div>
                <div id="block4-tasks" class="space-y-5"></div>
            </section>

            <div class="w-full h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent my-10"></div>

            <section class="space-y-6">
                <div class="flex items-center gap-4 border-b border-slate-100 pb-4">
                    <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center text-xl shadow-inner shadow-indigo-200">üéØ</div>
                    <h2 class="text-3xl font-black text-slate-800">–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</h2>
                </div>
                <div id="final-test" class="space-y-5"></div>
            </section>

            <div class="pt-8 text-center">
                <button onclick="finishLesson()" class="w-full md:w-2/3 mx-auto bg-slate-900 text-white py-5 rounded-3xl font-black text-lg hover:bg-indigo-600 transition-all shadow-lg shadow-indigo-200 transform hover:-translate-y-1 active:scale-95">
                    –ó–ê–í–ï–†–®–ò–¢–ò –£–†–û–ö
                </button>
            </div>
        </main>
    </div>

    <div class="hidden lg:flex w-1/2 flex-col bg-slate-50 relative p-6 h-screen">
        <div class="absolute top-8 left-1/2 -translate-x-1/2 z-40 flex items-center gap-2 bg-white p-2 rounded-2xl shadow-xl shadow-slate-200/50 border border-slate-100">
            <button onclick="setTool('pen')" id="tool-pen" class="p-3 rounded-xl tool-active transition" title="–û–ª—ñ–≤–µ—Ü—å">‚úèÔ∏è</button>
            <button onclick="setTool('eraser')" id="tool-eraser" class="p-3 rounded-xl hover:bg-slate-100 transition" title="–ì—É–º–∫–∞">üßΩ</button>
            <div class="w-px h-8 bg-slate-200 mx-1"></div>
            <button onclick="toggleGrid()" id="tool-grid" class="px-3 py-2 text-xs font-bold text-slate-500 hover:bg-slate-100 rounded-lg transition" title="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∞ —Å—ñ—Ç–∫–∞">üåê –°—ñ—Ç–∫–∞</button>
            <button onclick="drawNumberLine()" class="px-3 py-2 text-xs font-bold text-indigo-600 hover:bg-indigo-50 rounded-lg transition" title="–ß–∏—Å–ª–æ–≤–∞ –ø—Ä—è–º–∞">üìè –ß–∏—Å–ª–æ–≤–∞ –ø—Ä—è–º–∞</button>
            <div class="w-px h-8 bg-slate-200 mx-1"></div>
            <button onclick="clearCanvas()" class="p-3 text-red-500 hover:bg-red-50 rounded-xl transition" title="–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ">üóëÔ∏è</button>
        </div>

        <div class="canvas-container flex-1 bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mt-16" id="canvas-wrap">
            <canvas id="whiteboard"></canvas>
        </div>
    </div>

    <div id="result-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-10 max-w-md w-full text-center shadow-2xl transform scale-95 transition-all" id="modal-content">
            <div class="text-6xl mb-4" id="res-emoji">üéØ</div>
            <h2 class="text-3xl font-black text-slate-800 mb-2">–Ü–Ω—Ç–µ–Ω—Å–∏–≤ –ü—Ä–æ–π–¥–µ–Ω–æ!</h2>
            <div class="inline-block bg-indigo-50 border border-indigo-100 rounded-2xl px-6 py-3 mb-6">
                <p class="text-sm font-bold text-indigo-400 uppercase tracking-wide mb-1">–¢–≤—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</p>
                <p id="res-score" class="text-indigo-600 font-black text-4xl">0 / 40</p>
            </div>
            <p id="res-message" class="text-slate-600 mb-8 font-medium leading-relaxed"></p>
            <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold hover:bg-indigo-600 transition shadow-lg active:scale-95">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑</button>
        </div>
    </div>

<script>
    let totalScore = 0;
    let answeredTasks = 0;
    const TOTAL_TASKS = 40;

    function updateProgress() {
        answeredTasks++;
        document.getElementById('prog-text').innerText = `${answeredTasks}/${TOTAL_TASKS}`;
        document.getElementById('prog-bar').style.width = `${(answeredTasks / TOTAL_TASKS) * 100}%`;
    }

    function checkLogicPuzzle() {
        const inp = document.getElementById('logic-input');
        const msg = document.getElementById('logic-msg');
        const val = inp.value.trim().toUpperCase();
        
        if (val === '–ß') {
            msg.innerText = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¶–µ –ß–µ—Ä–≤–µ–Ω—å üéâ";
            msg.className = "text-sm font-bold mt-3 text-green-600 block";
            inp.classList.add('input-correct');
            inp.disabled = true;
        } else {
            msg.innerText = "–°–ø—Ä–æ–±—É–π —â–µ! –ü—ñ–¥–∫–∞–∑–∫–∞ –Ω–∏–∂—á–µ –¥–æ–ø–æ–º–æ–∂–µ.";
            msg.className = "text-sm font-bold mt-3 text-red-500 block";
            inp.classList.add('input-wrong');
            setTimeout(() => inp.classList.remove('input-wrong'), 1500);
        }
    }

    // 33 –ó–∞–≤–¥–∞–Ω–Ω—è –∑ —Ä—É—á–Ω–∏–º –≤–≤–æ–¥–æ–º —Ä–æ–∑–±–∏—Ç—ñ –Ω–∞ 4 –±–ª–æ–∫–∏ –ø–æ —Ä—ñ–≤–Ω—è—Ö —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
    const inputTasks = [
        // === –ë–õ–û–ö 1: –ó–∞–≥–∞–ª—å–Ω—ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ (5 –∑–∞–≤–¥–∞–Ω—å) ===
        { q: "–Ø–∫–µ —á–∏—Å–ª–æ –Ω–∞—Å—Ç—É–ø–Ω–µ: 2, 4, 6, 8, ... ?", a: 10, h: "–î–æ–¥–∞—î—Ç—å—Å—è –ø–æ 2.", s: "8 + 2 = 10", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ü—Ä–æ–¥–æ–≤–∂–∏ —Ä—è–¥: 10, 20, 30, ... ?", a: 40, h: "–î–æ–¥–∞—î—Ç—å—Å—è –ø–æ 10.", s: "30 + 10 = 40", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–Ø–∫–µ –Ω–∞—Å—Ç—É–ø–Ω–µ: 100, 99, 98, ... ?", a: 97, h: "–í—ñ–¥–Ω—ñ–º–∞—î—Ç—å—Å—è –ø–æ 1.", s: "98 - 1 = 97", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ó–Ω–∞–π–¥–∏ –∑–∞–∫–æ–Ω–æ–º—ñ—Ä–Ω—ñ—Å—Ç—å: 1, 4, 9, 16, ... ?", a: 25, h: "–¶–µ –∫–≤–∞–¥—Ä–∞—Ç–∏ —á–∏—Å–µ–ª: 1¬≤, 2¬≤, 3¬≤, 4¬≤...", s: "5¬≤ = 25", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–Ø–∫–µ –Ω–∞—Å—Ç—É–ø–Ω–µ: 2, 4, 8, 16, ... ?", a: 32, h: "–ö–æ–∂–Ω–µ —á–∏—Å–ª–æ –º–Ω–æ–∂–∏—Ç—å—Å—è –Ω–∞ 2.", s: "16 * 2 = 32", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },

        // === –ë–õ–û–ö 2: –†—ñ–∑–Ω–∏—Ü—è —Ç–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —á–ª–µ–Ω (10 –∑–∞–≤–¥–∞–Ω—å) ===
        { q: "–î–∞–Ω–æ \( a_1 = 5 \), \( a_2 = 8 \). –ó–Ω–∞–π–¥–∏ —Ä—ñ–∑–Ω–∏—Ü—é \( d \).", a: 3, h: "–í—ñ–¥–Ω—ñ–º–∏ –ø–µ—Ä—à–µ —á–∏—Å–ª–æ –≤—ñ–¥ –¥—Ä—É–≥–æ–≥–æ: 8 - 5", s: "\( d = 8 - 5 = 3 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–î–∞–Ω–æ \( a_1 = 10 \), \( a_2 = 5 \). –ó–Ω–∞–π–¥–∏ \( d \).", a: -5, h: "–ü—Ä–æ–≥—Ä–µ—Å—ñ—è —Å–ø–∞–¥–Ω–∞. 5 - 10 = ?", s: "\( d = 5 - 10 = -5 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–Ø–∫—â–æ \( a_1 = 2 \), \( d = 4 \). –ó–Ω–∞–π–¥–∏ \( a_2 \).", a: 6, h: "–î–æ–¥–∞–π —Ä—ñ–∑–Ω–∏—Ü—é –¥–æ –ø–µ—Ä—à–æ–≥–æ.", s: "\( a_2 = 2 + 4 = 6 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–Ø–∫—â–æ \( a_3 = 15 \), \( d = 5 \). –ó–Ω–∞–π–¥–∏ \( a_4 \).", a: 20, h: "–ù–∞—Å—Ç—É–ø–Ω–µ = –ø–æ–ø–µ—Ä–µ–¥–Ω—î + —Ä—ñ–∑–Ω–∏—Ü—è.", s: "\( a_4 = 15 + 5 = 20 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ó–Ω–∞–π–¥–∏ \( d \) –¥–ª—è —Ä—è–¥—É: 1, 5, 9, 13...", a: 4, h: "–ù–∞ —Å–∫—ñ–ª—å–∫–∏ 5 –±—ñ–ª—å—à–µ –∑–∞ 1?", s: "\( d = 5 - 1 = 4 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        
        { q: "–í—ñ–¥–æ–º–æ, —â–æ \( a_4 = 10 \), \( a_5 = 7 \). –ó–Ω–∞–π–¥–∏ \( d \).", a: -3, h: "–í—ñ–¥ 5-–≥–æ —á–ª–µ–Ω–∞ –≤—ñ–¥–Ω—ñ–º–∏ 4-–π.", s: "\( d = 7 - 10 = -3 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–Ø–∫—â–æ \( a_2 = 12 \) —ñ \( d = 4 \). –ó–Ω–∞–π–¥–∏ –ü–ï–†–®–ò–ô —á–ª–µ–Ω \( a_1 \).", a: 8, h: "–©–æ–± –∑–Ω–∞–π—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π, —Ç—Ä–µ–±–∞ –≤—ñ–¥–Ω—è—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é.", s: "\( a_1 = 12 - 4 = 8 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–ó–Ω–∞–π–¥–∏ \( d \) –¥–ª—è —Ä—è–¥—É: -5, -2, 1, 4...", a: 3, h: "–í—ñ–¥ -2 –≤—ñ–¥–Ω—ñ–º–∏ -5.", s: "\( d = -2 - (-5) = 3 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        
        { q: "–Ø–∫—â–æ \( a_3 = 0 \), \( a_4 = -5 \). –ó–Ω–∞–π–¥–∏ \( d \).", a: -5, h: "–í—ñ–¥ -5 –≤—ñ–¥–Ω—ñ–º–∏ 0.", s: "\( d = -5 - 0 = -5 \)", lvl: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { q: "–Ø–∫—â–æ \( a_2 = -10 \) —ñ \( d = -5 \). –ó–Ω–∞–π–¥–∏ \( a_1 \).", a: -5, h: "–í—ñ–¥ -10 –≤—ñ–¥–Ω—ñ–º–∏ -5.", s: "\( a_1 = -10 - (-5) = -5 \)", lvl: "–°–∫–ª–∞–¥–Ω–∏–π" },

        // === –ë–õ–û–ö 3: –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è n-–≥–æ —á–ª–µ–Ω–∞ (10 –∑–∞–≤–¥–∞–Ω—å) ===
        { q: "–ù–µ—Ö–∞–π \( a_1 = 1 \), \( d = 2 \). –ó–Ω–∞–π–¥–∏ \( a_5 \).", a: 9, h: "–§–æ—Ä–º—É–ª–∞: \( a_5 = a_1 + d \cdot 4 \)", s: "\( a_5 = 1 + 2 \cdot 4 = 9 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ù–µ—Ö–∞–π \( a_1 = 10 \), \( d = 5 \). –ó–Ω–∞–π–¥–∏ \( a_4 \).", a: 25, h: "–ó—Ä–æ–±–∏ 3 –∫—Ä–æ–∫–∏ –ø–æ 5.", s: "\( a_4 = 10 + 5 \cdot 3 = 25 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ù–µ—Ö–∞–π \( a_1 = 0 \), \( d = 3 \). –ó–Ω–∞–π–¥–∏ \( a_{10} \).", a: 27, h: "–ö—Ä–æ–∫—ñ–≤ –±—É–¥–µ 9.", s: "\( a_{10} = 0 + 3 \cdot 9 = 27 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ù–µ—Ö–∞–π \( a_1 = -2 \), \( d = 2 \). –ó–Ω–∞–π–¥–∏ \( a_6 \).", a: 8, h: "–ö—Ä–æ–∫—ñ–≤ 5.", s: "\( a_6 = -2 + 2 \cdot 5 = 8 \)", lvl: "–õ–µ–≥–∫–∏–π" },
        
        { q: "–ù–µ—Ö–∞–π \( a_1 = 100 \), \( d = -10 \). –ó–Ω–∞–π–¥–∏ \( a_{11} \).", a: 0, h: "10 –∫—Ä–æ–∫—ñ–≤ –ø–æ -10.", s: "\( a_{11} = 100 + (-10) \cdot 10 = 0 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–ù–µ—Ö–∞–π \( a_1 = 7 \), \( d = 1 \). –ó–Ω–∞–π–¥–∏ \( a_{50} \).", a: 56, h: "49 –∫—Ä–æ–∫—ñ–≤ –ø–æ 1.", s: "\( a_{50} = 7 + 1 \cdot 49 = 56 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–î–∞–Ω–æ: 3, 6, 9... –ó–Ω–∞–π–¥–∏ 8-–π —á–ª–µ–Ω.", a: 24, h: "–ó–Ω–∞–π–¥–∏ d (—Ç—É—Ç 3). –ü–æ—Ç—ñ–º –∑–∞—Å—Ç–æ—Å—É–π —Ñ–æ—Ä–º—É–ª—É.", s: "\( a_8 = 3 + 3 \cdot 7 = 24 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–î–∞–Ω–æ: 20, 18, 16... –ó–Ω–∞–π–¥–∏ 11-–π —á–ª–µ–Ω.", a: 0, h: "–ó–Ω–∞–π–¥–∏ d (—Ç—É—Ç -2).", s: "\( a_{11} = 20 + (-2) \cdot 10 = 0 \)", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        
        { q: "–ù–µ—Ö–∞–π \( a_1 = -15 \), \( d = 4 \). –ó–Ω–∞–π–¥–∏ \( a_{10} \).", a: 21, h: "–§–æ—Ä–º—É–ª–∞: -15 + 4 * 9", s: "\( a_{10} = -15 + 36 = 21 \)", lvl: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { q: "–ù–µ—Ö–∞–π \( a_1 = -50 \), \( d = 15 \). –ó–Ω–∞–π–¥–∏ \( a_5 \).", a: 10, h: "–§–æ—Ä–º—É–ª–∞: -50 + 15 * 4", s: "\( a_5 = -50 + 60 = 10 \)", lvl: "–°–∫–ª–∞–¥–Ω–∏–π" },

        // === –ë–õ–û–ö 4: –†—ñ–≤–Ω—è–Ω–Ω—è —Ç–∞ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ (8 –∑–∞–≤–¥–∞–Ω—å) ===
        { q: "–í—ñ–¥–æ–º–æ: \( a_n = 23 \), \( a_1 = 3 \), \( d = 5 \). –ó–Ω–∞–π–¥–∏ –Ω–æ–º–µ—Ä \( n \).", a: 5, h: "–°–∫–ª–∞–¥–∏ —Ä—ñ–≤–Ω—è–Ω–Ω—è: 23 = 3 + 5(n-1)", s: "20 = 5(n-1) ‚Üí 4 = n-1 ‚Üí n = 5", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–í—ñ–¥–æ–º–æ: \( a_n = 40 \), \( a_1 = 10 \), \( d = 10 \). –ó–Ω–∞–π–¥–∏ \( n \).", a: 4, h: "40 = 10 + 10(n-1)", s: "30 = 10(n-1) ‚Üí 3 = n-1 ‚Üí n = 4", lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–Ø–∫—â–æ \( a_{10} = 30 \) —ñ \( d = 3 \). –ó–Ω–∞–π–¥–∏ \( a_1 \).", a: 3, h: "–ü—ñ–¥—Å—Ç–∞–≤: 30 = a_1 + 3 * 9", s: "30 = a_1 + 27 ‚Üí a_1 = 3", lvl: "–õ–µ–≥–∫–∏–π" },
        
        { q: "–ß–∏—Å–ª–æ 0 —î —á–ª–µ–Ω–æ–º –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó, –¥–µ \( a_1 = 20 \), \( d = -4 \). –ó–Ω–∞–π–¥–∏ –π–æ–≥–æ –Ω–æ–º–µ—Ä.", a: 6, h: "0 = 20 - 4(n-1)", s: "4(n-1) = 20 ‚Üí n-1 = 5 ‚Üí n = 6", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–Ø–∫—â–æ \( a_5 = 20 \) —ñ \( d = 4 \). –ó–Ω–∞–π–¥–∏ \( a_1 \).", a: 4, h: "20 = a_1 + 4 * 4", s: "20 = a_1 + 16 ‚Üí a_1 = 4", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–î–∞–Ω–æ \( a_1 = 2 \) —Ç–∞ \( a_3 = 10 \). –ó–Ω–∞–π–¥–∏ —Å–µ—Ä–µ–¥–Ω—ñ–π —á–ª–µ–Ω \( a_2 \).", a: 6, h: "–í–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å: a_2 = (a_1 + a_3) / 2", s: "(2 + 10) / 2 = 6", lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        
        { q: "–î–∞–Ω–æ \( a_3 = 10 \), \( a_5 = 14 \). –ó–Ω–∞–π–¥–∏ —Ä—ñ–∑–Ω–∏—Ü—é \( d \).", a: 2, h: "–í—ñ–¥ a_3 –¥–æ a_5 —Ä—ñ–≤–Ω–æ 2 –∫—Ä–æ–∫–∏. 2d = 14 - 10", s: "2d = 4 ‚Üí d = 2", lvl: "–°–∫–ª–∞–¥–Ω–∏–π" },
        { q: "–î–∞–Ω–æ \( a_4 = 10 \), \( a_6 = 0 \). –ó–Ω–∞–π–¥–∏ \( d \).", a: -5, h: "2d = 0 - 10", s: "2d = -10 ‚Üí d = -5", lvl: "–°–∫–ª–∞–¥–Ω–∏–π" }
    ];

    // 7 –ó–∞–≤–¥–∞–Ω—å —É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç—ñ
    const testTasks = [
        { q: "–©–æ —Ç–∞–∫–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—ñ—è?", opts: ["–ö–æ–∂–Ω–µ —á–∏—Å–ª–æ –º–Ω–æ–∂–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–µ –π —Ç–µ —Å–∞–º–µ", "–î–æ –∫–æ–∂–Ω–æ–≥–æ —á–∏—Å–ª–∞ –¥–æ–¥–∞—î—Ç—å—Å—è –æ–¥–Ω–µ –π —Ç–µ —Å–∞–º–µ —á–∏—Å–ª–æ", "–ö–≤–∞–¥—Ä–∞—Ç–∏ —á–∏—Å–µ–ª"], a: 1, lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–Ø–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ \( n \)-–≥–æ —á–ª–µ–Ω–∞?", opts: ["\\( a_n = a_1 \\cdot d^{n-1} \\)", "\\( a_n = a_1 + d(n-1) \\)", "\\( a_n = a_1 + dn \\)"], a: 1, lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–ó–Ω–∞–π–¥–∏ —Ä—ñ–∑–Ω–∏—Ü—é \( d \) –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó: 5, 1, -3, -7...", opts: ["4", "-4", "1"], a: 1, lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–ß–∏ —î –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å 2, 4, 8, 16... –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–æ—é –ø—Ä–æ–≥—Ä–µ—Å—ñ—î—é?", opts: ["–¢–∞–∫, –±–æ –≤–æ–Ω–∞ –∑—Ä–æ—Å—Ç–∞—î", "–¢–∞–∫, —Ä—ñ–∑–Ω–∏—Ü—è –¥–æ—Ä—ñ–≤–Ω—é—î 2", "–ù—ñ, —Ç—É—Ç —á–∏—Å–ª–∞ –º–Ω–æ–∂–∞—Ç—å—Å—è"], a: 2, lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–ó–Ω–∞–π–¥–∏ \( a_3 \), —è–∫—â–æ \( a_1 = 1 \) —ñ \( d = 5 \).", opts: ["11", "15", "6"], a: 0, lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π" },
        { q: "–Ø–∫—â–æ —Ä—ñ–∑–Ω–∏—Ü—è \( d > 0 \), —Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—ñ—è —î...", opts: ["–°–ø–∞–¥–Ω–æ—é", "–ó—Ä–æ—Å—Ç–∞—é—á–æ—é", "–°—Ç–∞–ª–æ—é"], a: 1, lvl: "–õ–µ–≥–∫–∏–π" },
        { q: "–í–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —á–ª–µ–Ω–∞ –¥–ª—è \( x, y, z \):", opts: ["\( y = (x+z)/2 \)", "\( y = x \cdot z \)", "\( y = z - x \)"], a: 0, lvl: "–°–∫–ª–∞–¥–Ω–∏–π" }
    ];

    let taskStates = new Array(TOTAL_TASKS).fill(false);

    window.onload = () => {
        renderInputTasks('block1-tasks', 0, 5, 'blue');
        renderInputTasks('block2-tasks', 5, 15, 'purple');
        renderInputTasks('block3-tasks', 15, 25, 'emerald');
        renderInputTasks('block4-tasks', 25, 33, 'rose');
        renderTestTasks();
        MathJax.typesetPromise();
        setTimeout(resizeCanvas, 100);
    };

    function renderInputTasks(containerId, startIdx, endIdx, color) {
        const container = document.getElementById(containerId);
        let html = '';
        for(let i = startIdx; i < endIdx; i++) {
            let task = inputTasks[i];
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–æ–ª—ñ—Ä –±–µ–π–¥–∂–∞
            let badgeColor = task.lvl === '–õ–µ–≥–∫–∏–π' ? 'bg-green-100 text-green-700' :
                             task.lvl === '–°–µ—Ä–µ–¥–Ω—ñ–π' ? 'bg-amber-100 text-amber-700' :
                             'bg-red-100 text-red-700';

            html += `
            <div class="task-card bg-white p-6 rounded-[2rem]" id="task-${i}">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <span class="w-8 h-8 rounded-full bg-${color}-100 text-${color}-600 font-black flex items-center justify-center shrink-0 text-sm">${i + 1}</span>
                        <span class="px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide ${badgeColor}">${task.lvl}</span>
                    </div>
                </div>
                
                <h3 class="text-base font-bold text-slate-800 leading-relaxed mb-4">${task.q}</h3>
                
                <div class="flex flex-col sm:flex-row gap-3 mt-2">
                    <div class="relative flex-1">
                        <input type="number" id="input-${i}" class="input-base w-full" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">
                    </div>
                    <button onclick="checkInputTask(${i}, ${task.a})" id="btn-${i}" class="px-6 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-${color}-600 transition shadow-md active:scale-95 whitespace-nowrap">
                        –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏
                    </button>
                </div>

                <div class="flex justify-between items-center mt-5 pt-4 border-t border-slate-50">
                    <button onclick="toggleElement('hint-${i}')" class="text-xs font-bold text-slate-400 hover:text-${color}-500 uppercase flex items-center gap-1"><span class="text-base">üí°</span> –ü—ñ–¥–∫–∞–∑–∫–∞</button>
                    <button onclick="toggleElement('sol-${i}')" class="text-xs font-bold text-slate-400 hover:text-${color}-500 uppercase flex items-center gap-1">–†—ñ—à–µ–Ω–Ω—è <span class="text-base">üëÅÔ∏è</span></button>
                </div>
                
                <div id="hint-${i}" class="hidden mt-4 p-4 bg-yellow-50/80 rounded-2xl text-sm border border-yellow-100 text-yellow-800 font-medium">
                    ${task.h}
                </div>
                <div id="sol-${i}" class="hidden mt-4 p-4 bg-${color}-50/80 rounded-2xl text-sm border border-${color}-100 text-${color}-800 italic">
                    <b>–ü–æ—è—Å–Ω–µ–Ω–Ω—è:</b> ${task.s}
                </div>
            </div>`;
        }
        container.innerHTML = html;
    }

    function renderTestTasks() {
        const container = document.getElementById('final-test');
        let html = '';
        testTasks.forEach((task, idx) => {
            const globalIdx = idx + 33; 
            
            let badgeColor = task.lvl === '–õ–µ–≥–∫–∏–π' ? 'bg-green-100 text-green-700' :
                             task.lvl === '–°–µ—Ä–µ–¥–Ω—ñ–π' ? 'bg-amber-100 text-amber-700' :
                             'bg-red-100 text-red-700';

            let optsHTML = task.opts.map((opt, oIdx) => `
                <button id="testbtn-${globalIdx}-${oIdx}" onclick="checkTestTask(${globalIdx}, ${oIdx}, ${task.a})" class="option-btn w-full text-left p-4 rounded-2xl border-2 border-slate-100 bg-slate-50 font-medium text-slate-700 flex items-center gap-3">
                    <div class="w-5 h-5 rounded-full border-2 border-slate-300 flex-shrink-0 flex items-center justify-center" id="testcircle-${globalIdx}-${oIdx}"></div>
                    <span>${opt}</span>
                </button>
            `).join('');

            html += `
            <div class="task-card bg-white p-6 rounded-[2rem]">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <span class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 font-black flex items-center justify-center shrink-0 text-sm">${globalIdx + 1}</span>
                        <span class="px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide ${badgeColor}">${task.lvl}</span>
                    </div>
                </div>
                <h3 class="text-base font-bold text-slate-800 leading-relaxed mb-4">${task.q}</h3>
                <div class="grid grid-cols-1 gap-3">
                    ${optsHTML}
                </div>
            </div>`;
        });
        container.innerHTML = html;
    }

    function checkInputTask(id, correctAns) {
        if(taskStates[id]) return;

        const inp = document.getElementById(`input-${id}`);
        const btn = document.getElementById(`btn-${id}`);
        const userVal = parseFloat(inp.value.trim());

        if(isNaN(userVal)) {
            alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —á–∏—Å–ª–æ!");
            return;
        }

        if(userVal === correctAns) {
            inp.classList.add('input-correct');
            inp.disabled = true;
            btn.innerHTML = "–í—ñ—Ä–Ω–æ! ‚úì";
            btn.classList.replace('bg-slate-900', 'bg-green-600');
            btn.disabled = true;
            totalScore++;
        } else {
            inp.classList.add('input-wrong');
            setTimeout(() => inp.classList.remove('input-wrong'), 1000);
            return; 
        }
        
        taskStates[id] = true;
        updateProgress();
    }

    function checkTestTask(globalIdx, userOpt, correctOpt) {
        if(taskStates[globalIdx]) return;

        const taskLocalIdx = globalIdx - 33;
        const task = testTasks[taskLocalIdx];
        
        const selectedBtn = document.getElementById(`testbtn-${globalIdx}-${userOpt}`);
        const selectedCircle = document.getElementById(`testcircle-${globalIdx}-${userOpt}`);
        const correctBtn = document.getElementById(`testbtn-${globalIdx}-${correctOpt}`);
        const correctCircle = document.getElementById(`testcircle-${globalIdx}-${correctOpt}`);

        task.opts.forEach((_, i) => {
            const btn = document.getElementById(`testbtn-${globalIdx}-${i}`);
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-not-allowed');
        });

        if(userOpt === correctOpt) {
            selectedBtn.classList.remove('bg-slate-50', 'border-slate-100', 'opacity-70');
            selectedBtn.classList.add('option-correct');
            selectedCircle.innerHTML = '<div class="w-2.5 h-2.5 bg-green-600 rounded-full"></div>';
            selectedCircle.classList.replace('border-slate-300', 'border-green-600');
            totalScore++;
        } else {
            selectedBtn.classList.remove('bg-slate-50', 'border-slate-100', 'opacity-70');
            selectedBtn.classList.add('option-wrong');
            selectedCircle.innerHTML = '<div class="w-2.5 h-2.5 bg-red-600 rounded-full"></div>';
            selectedCircle.classList.replace('border-slate-300', 'border-red-600');
            
            correctBtn.classList.remove('bg-slate-50', 'border-slate-100', 'opacity-70');
            correctBtn.classList.add('option-correct', 'opacity-100');
            correctCircle.innerHTML = '<div class="w-2.5 h-2.5 bg-green-600 rounded-full"></div>';
            correctCircle.classList.replace('border-slate-300', 'border-green-600');
        }

        taskStates[globalIdx] = true;
        updateProgress();
    }

    function toggleElement(id) {
        const el = document.getElementById(id);
        el.classList.toggle('hidden');
    }

    function finishLesson() {
        const modal = document.getElementById('result-modal');
        const modalContent = document.getElementById('modal-content');
        const scoreEl = document.getElementById('res-score');
        const msgEl = document.getElementById('res-message');
        const emojiEl = document.getElementById('res-emoji');

        scoreEl.innerText = `${totalScore} / ${TOTAL_TASKS}`;

        let percent = totalScore / TOTAL_TASKS;
        if (percent >= 0.9) {
            emojiEl.innerText = "üèÜ";
            msgEl.innerHTML = "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞! 40 –∑–∞–≤–¥–∞–Ω—å ‚Äî —Ü–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞—Ä–∞—Ñ–æ–Ω, —ñ —Ç–∏ –ø—Ä–æ–π—à–æ–≤ –π–æ–≥–æ –±–ª–∏—Å–∫—É—á–µ. –¢–∏ –µ–∫—Å–ø–µ—Ä—Ç –∑ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–æ—ó –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó!";
        } else if (percent >= 0.6) {
            emojiEl.innerText = "üëç";
            msgEl.innerHTML = "–î—É–∂–µ –¥–æ–±—Ä–µ! –í–µ–ª–∏–∫–∏–π –æ–±—Å—è–≥ —Ä–æ–±–æ—Ç–∏, —ñ —Ç–∏ –≤–ø–æ—Ä–∞–≤—Å—è –∑ –±—ñ–ª—å—à—ñ—Å—Ç—é. –ü–µ—Ä–µ–≥–ª—è–Ω—å –∑–∞–≤–¥–∞–Ω–Ω—è –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º '–°–∫–ª–∞–¥–Ω–∏–π' —ñ —Ä—É—Ö–∞–π—Å—è –¥–∞–ª—ñ!";
        } else {
            emojiEl.innerText = "üí™";
            msgEl.innerHTML = "–¶–µ –±—É–≤ —Å–∫–ª–∞–¥–Ω–∏–π —ñ–Ω—Ç–µ–Ω—Å–∏–≤! –ù–µ –∑–¥–∞–≤–∞–π—Å—è, –ø—Ä–æ–≥—Ä–µ—Å—ñ—è –ø–æ—Ç—Ä–µ–±—É—î –ø—Ä–∞–∫—Ç–∏–∫–∏. –ü–æ–≤—Ç–æ—Ä–∏ —Ñ–æ—Ä–º—É–ª–∏ —ñ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.";
        }

        modal.classList.remove('hidden');
        setTimeout(() => modalContent.classList.remove('scale-95'), 10);
    }

    // --- –õ–û–ì–Ü–ö–ê –î–û–®–ö–ò (WHITEBOARD) ---
    const canvas = document.getElementById('whiteboard');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-wrap');
    
    let isDrawing = false;
    let currentTool = 'pen';
    let showGrid = false;

    function resizeCanvas() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        redrawCanvas();
    }

    function redrawCanvas() {
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        if (showGrid) drawGrid();
    }

    function setTool(tool) {
        currentTool = tool;
        document.getElementById('tool-pen').classList.toggle('tool-active', tool === 'pen');
        document.getElementById('tool-eraser').classList.toggle('tool-active', tool === 'eraser');
    }

    function getMousePos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX || (e.touches && e.touches.length > 0 ? e.touches[0].clientX : 0);
        const clientY = e.clientY || (e.touches && e.touches.length > 0 ? e.touches[0].clientY : 0);
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function startPosition(e) { isDrawing = true; draw(e); }
    function endPosition() { isDrawing = false; ctx.beginPath(); }

    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();

        const pos = getMousePos(e);
        ctx.lineWidth = currentTool === 'eraser' ? 30 : 3;
        ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : '#1e293b';

        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (showGrid) drawGrid();
    }

    function toggleGrid() {
        showGrid = !showGrid;
        const btn = document.getElementById('tool-grid');
        if (showGrid) {
            btn.classList.add('bg-slate-200', 'text-indigo-600');
            drawGrid();
        } else {
            btn.classList.remove('bg-slate-200', 'text-indigo-600');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    }

    function drawNumberLine() {
        ctx.save();
        const cy = canvas.height / 2;
        const startX = 50;
        const endX = canvas.width - 50;
        
        ctx.strokeStyle = '#4f46e5';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(startX, cy);
        ctx.lineTo(endX, cy);
        
        ctx.lineTo(endX - 15, cy - 10);
        ctx.moveTo(endX, cy);
        ctx.lineTo(endX - 15, cy + 10);
        ctx.stroke();

        const step = (endX - startX - 40) / 4;
        ctx.fillStyle = '#1e293b';
        ctx.font = '14px Plus Jakarta Sans';
        ctx.textAlign = 'center';
        
        for(let i=0; i<5; i++) {
            let px = startX + i * step;
            ctx.beginPath();
            ctx.moveTo(px, cy - 10);
            ctx.lineTo(px, cy + 10);
            ctx.stroke();
            
            ctx.fillText(`a${i+1}`, px, cy + 30);
        }

        ctx.strokeStyle = '#f59e0b';
        ctx.setLineDash([5, 5]);
        ctx.lineWidth = 2;
        for(let i=0; i<4; i++) {
            let px1 = startX + i * step;
            let px2 = startX + (i+1) * step;
            let midX = (px1 + px2) / 2;
            
            ctx.beginPath();
            ctx.arc(midX, cy, step/2, Math.PI, 0);
            ctx.stroke();
            ctx.fillText('+d', midX, cy - step/2 - 10);
        }
        
        ctx.restore();
        setTool('pen');
    }

    canvas.addEventListener('mousedown', startPosition);
    canvas.addEventListener('mouseup', endPosition);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseout', endPosition);

    canvas.addEventListener('touchstart', startPosition, { passive: false });
    canvas.addEventListener('touchend', endPosition);
    canvas.addEventListener('touchmove', draw, { passive: false });

    window.addEventListener('resize', resizeCanvas);

</script>
</body>
</html>