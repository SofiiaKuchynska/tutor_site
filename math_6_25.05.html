<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rational Master: –¢—Ä–µ–Ω–∞–∂–µ—Ä –∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 2px solid #f8fafc; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .task-card { border: 2px solid #e2e8f0; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); }
        .task-card:hover { border-color: #3b82f6; box-shadow: 0 12px 20px -5px rgba(59, 130, 246, 0.15); transform: translateY(-2px); }
        .solved-card { border-color: #10b981 !important; background-color: #f0fdf4 !important; box-shadow: 0 4px 15px -3px rgba(16, 185, 129, 0.1) !important; }
        
        .whiteboard-container { 
            background-color: #ffffff;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px); 
            background-size: 24px 24px; 
        }
        .tool-active { @apply bg-indigo-600 text-white shadow-lg scale-105; }
        
        .hero-gradient { background: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%); }
        .glass-panel { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        
        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ –∑–∞–≤–¥–∞–Ω—å */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }
    </style>
</head>
<body class="h-screen flex text-slate-800">

    <div class="w-full lg:w-[55%] flex flex-col bg-slate-50 border-r border-slate-200 relative z-10 shadow-2xl">
        
        <header class="px-8 py-5 border-b border-slate-200 flex justify-between items-center bg-white/90 backdrop-blur-md sticky top-0 z-50">
            <div>
                <h1 class="text-2xl font-black text-slate-900 tracking-tight">Rational <span class="text-indigo-600">Master</span></h1>
                <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-1">–ö–ª–∞—Å: 6 ‚Ä¢ –†–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —á–∏—Å–ª–∞</p>
            </div>
            <div class="text-right flex flex-col items-end">
                <div class="text-sm font-black text-indigo-600 mb-1" id="prog-label">0 –∑ 30 –∑–∞–≤–¥–∞–Ω—å</div>
                <div class="w-40 h-3 bg-slate-100 rounded-full overflow-hidden shadow-inner">
                    <div id="prog-bar" class="h-full bg-gradient-to-r from-indigo-500 to-blue-500 transition-all duration-700 ease-out" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto px-8 py-10 custom-scrollbar scroll-smooth" id="main-content">
            
            <div class="hero-gradient text-white p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden mb-12">
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl"></div>
                <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-blue-300 opacity-20 rounded-full blur-xl"></div>
                
                <h2 class="text-3xl font-black mb-3 relative z-10">–í—ñ—Ç–∞—î–º–æ –Ω–∞ –±–æ—Ä—Ç—É! üöÄ</h2>
                <p class="text-blue-50 text-base mb-8 leading-relaxed relative z-10 max-w-xl">
                    –¶–µ–π —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –¥–æ–ø–æ–º–æ–∂–µ —Ç–æ–±—ñ –æ–ø–∞–Ω—É–≤–∞—Ç–∏ —Ä–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —á–∏—Å–ª–∞. –ú–∏ –ø—Ä–æ–π–¥–µ–º–æ —à–ª—è—Ö –≤—ñ–¥ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–æ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ä—ñ–≤–Ω—è–Ω—å –∑ –º–æ–¥—É–ª—è–º–∏.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 relative z-10">
                    <div class="glass-panel p-4 rounded-2xl">
                        <div class="text-2xl mb-1">üéØ</div>
                        <div class="font-bold text-sm">30 –∑–∞–≤–¥–∞–Ω—å</div>
                        <div class="text-xs text-blue-100 opacity-80 mt-1">–í—ñ–¥ –ª–µ–≥–∫–æ–≥–æ –¥–æ –ø—Ä–æ—Ñ—ñ</div>
                    </div>
                    <div class="glass-panel p-4 rounded-2xl">
                        <div class="text-2xl mb-1">üí°</div>
                        <div class="font-bold text-sm">–†–æ–∑—É–º–Ω—ñ –ø—ñ–¥–∫–∞–∑–∫–∏</div>
                        <div class="text-xs text-blue-100 opacity-80 mt-1">–î–æ–ø–æ–º–æ–≥–∞ –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ</div>
                    </div>
                    <div class="glass-panel p-4 rounded-2xl">
                        <div class="text-2xl mb-1">‚úçÔ∏è</div>
                        <div class="font-bold text-sm">–î–æ—à–∫–∞-—á–µ—Ä–Ω–µ—Ç–∫–∞</div>
                        <div class="text-xs text-blue-100 opacity-80 mt-1">–ú–∞–ª—é–π —Ç–∞ –æ–±—á–∏—Å–ª—é–π —Å–ø—Ä–∞–≤–∞</div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-4 mb-10">
                <details class="group bg-white rounded-3xl border-2 border-slate-200 p-2 shadow-sm transition-all hover:border-indigo-300">
                    <summary class="flex items-center justify-between p-4 cursor-pointer font-bold text-slate-800">
                        <div class="flex items-center gap-3">
                            <span class="bg-indigo-100 text-indigo-600 p-2 rounded-xl">üìö</span>
                            <span>–®–ø–∞—Ä–≥–∞–ª–∫–∞: –ì–æ–ª–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞</span>
                        </div>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-slate-400">‚ñº</span>
                    </summary>
                    <div class="p-6 pt-2 space-y-4 text-sm text-slate-600 leading-relaxed border-t border-slate-100 mt-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-indigo-600 mb-2">‚ûï –î–æ–¥–∞–≤–∞–Ω–Ω—è —ñ –≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è</h4>
                                <ul class="list-disc pl-4 space-y-1">
                                    <li>–î–≤–∞ –º—ñ–Ω—É—Å–∏ (–±–æ—Ä–≥–∏) –¥–æ–¥–∞—é—Ç—å—Å—è: <br><code class="bg-slate-100 px-1 rounded">-3 - 2 = -5</code></li>
                                    <li>–ú—ñ–Ω—É—Å –Ω–∞ –º—ñ–Ω—É—Å = –ø–ª—é—Å: <br><code class="bg-slate-100 px-1 rounded">5 - (-3) = 5 + 3 = 8</code></li>
                                    <li>–†—ñ–∑–Ω—ñ –∑–Ω–∞–∫–∏ ‚Äî –≤—ñ–¥–Ω—ñ–º–∞—î–º–æ –≤—ñ–¥ –±—ñ–ª—å—à–æ–≥–æ: <br><code class="bg-slate-100 px-1 rounded">-8 + 5 = -3</code></li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-indigo-600 mb-2">üì¶ –†–æ–∑–∫—Ä–∏—Ç—Ç—è –¥—É–∂–æ–∫</h4>
                                <ul class="list-disc pl-4 space-y-1">
                                    <li>–ü–µ—Ä–µ–¥ –¥—É–∂–∫–∞–º–∏ <b>"+"</b>: –∑–Ω–∞–∫–∏ –ù–ï –∑–º—ñ–Ω—é—î–º–æ.</li>
                                    <li>–ü–µ—Ä–µ–¥ –¥—É–∂–∫–∞–º–∏ <b>"-"</b>: –∑–Ω–∞–∫–∏ –≤—Å—ñ—Ö –¥–æ–¥–∞–Ω–∫—ñ–≤ –∑–º—ñ–Ω—é—î–º–æ –Ω–∞ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ.</li>
                                    <li>–ú–æ–¥—É–ª—å —Ä–æ–±–∏—Ç—å —á–∏—Å–ª–æ –¥–æ–¥–∞—Ç–Ω–∏–º: <br><code class="bg-slate-100 px-1 rounded">|-7| = 7</code></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <div id="tasks-list" class="space-y-6 pb-10"></div>

            <div id="test-zone" class="hidden py-10 opacity-0 transition-opacity duration-1000">
                <div class="bg-slate-900 text-white rounded-[3rem] p-10 shadow-2xl relative overflow-hidden">
                    <div class="absolute -right-20 -top-20 text-[15rem] opacity-5">üèÜ</div>
                    <h2 class="text-3xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">–§—ñ–Ω–∞–ª—å–Ω–∏–π –ë–æ—Å</h2>
                    <p class="text-slate-400 mb-8">–î–æ–≤–µ–¥–∏ —Å–≤–æ—é –º–∞–π—Å—Ç–µ—Ä–Ω—ñ—Å—Ç—å, –≤—ñ–¥–ø–æ–≤—ñ–≤—à–∏ –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.</p>
                    
                    <div id="test-questions" class="space-y-6 relative z-10"></div>
                    
                    <button onclick="checkTest()" class="mt-10 w-full bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-5 rounded-2xl font-black text-lg hover:from-indigo-500 hover:to-blue-500 transition-all shadow-lg hover:shadow-indigo-500/30 transform hover:-translate-y-1">
                        –ó–î–ê–¢–ò –¢–ï–°–¢
                    </button>
                </div>
            </div>

            <div class="pt-5 pb-10">
                <button onclick="finishLesson()" class="w-full bg-slate-200 text-slate-800 py-6 rounded-3xl font-black text-xl hover:bg-slate-900 hover:text-white transition-all shadow-sm active:scale-[0.98]">
                    üèÅ –ü–Ü–î–ë–ò–¢–ò –ü–Ü–î–°–£–ú–ö–ò
                </button>
            </div>
        </main>
    </div>

    <div class="hidden lg:flex w-[45%] flex-col bg-slate-200 p-6 relative">
        <div class="absolute top-10 left-1/2 -translate-x-1/2 z-40 flex items-center gap-2 bg-white/95 backdrop-blur-md p-2 rounded-2xl shadow-xl border border-slate-200">
            <button onclick="setTool('pen')" id="btn-pen" class="p-3 rounded-xl tool-active transition-all" title="–û–ª—ñ–≤–µ—Ü—å">‚úèÔ∏è</button>
            <button onclick="setTool('eraser')" id="btn-eraser" class="p-3 rounded-xl hover:bg-slate-100 transition-all" title="–ì—É–º–∫–∞">üßΩ</button>
            <div class="w-px h-8 bg-slate-200 mx-2"></div>
            <button onclick="drawCoordinateLine()" class="flex items-center gap-2 px-4 py-2 text-xs font-black text-indigo-700 bg-indigo-50 hover:bg-indigo-100 rounded-xl uppercase transition-all">
                <span>üìè</span> –í—ñ—Å—å
            </button>
            <button onclick="clearCanvas()" class="flex items-center gap-2 px-4 py-2 text-xs font-black text-red-600 hover:bg-red-50 rounded-xl uppercase transition-all">
                <span>üóë</span> –û—á–∏—Å—Ç–∏—Ç–∏
            </button>
        </div>
        
        <div class="flex-1 whiteboard-container rounded-[2.5rem] shadow-inner border border-slate-300 overflow-hidden relative cursor-crosshair" id="canvas-parent">
            <canvas id="whiteboard" class="absolute inset-0 w-full h-full"></canvas>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[100] hidden flex-col items-center justify-center p-6 transition-all opacity-0">
        <div class="bg-white rounded-[3rem] p-12 max-w-md w-full text-center shadow-2xl transform scale-95 transition-all" id="modal-content">
            <div id="res-emoji" class="text-8xl mb-6 drop-shadow-lg">üéØ</div>
            <h2 id="res-title" class="text-4xl font-black text-slate-800 mb-2 tracking-tight">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
            <div class="bg-indigo-50 rounded-2xl p-6 my-6">
                <p id="res-score" class="text-indigo-600 font-black text-5xl mb-1"></p>
                <p class="text-slate-500 font-bold uppercase tracking-wider text-xs">–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</p>
            </div>
            <p id="res-msg" class="text-slate-600 mb-10 text-lg leading-relaxed"></p>
            <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black text-lg hover:bg-indigo-600 transition-colors shadow-xl">
                –ü–†–û–ô–¢–ò –©–ï –†–ê–ó
            </button>
        </div>
    </div>

<script>
    // ==========================================
    // –ë–ê–ó–ê –î–ê–ù–ò–• –ó–ê–í–î–ê–ù–¨ (30 –®–¢, –í—ñ–¥ –ª–µ–≥–∫–æ–≥–æ –¥–æ —Å–∫–ª–∞–¥–Ω–æ–≥–æ)
    // ==========================================
    const tasksData = [
        // –ü–û–ß–ê–¢–ö–û–í–ò–ô –†–Ü–í–ï–ù–¨ (–∑ –∑–æ–±—Ä–∞–∂–µ–Ω—å)
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å", n: "1", q: "–Ø–∫–µ –∑ —á–∏—Å–µ–ª 18; -5,6; 0; -9; -60 —î –Ω–∞–π–º–µ–Ω—à–∏–º —Ü—ñ–ª–∏–º?", a: "-60", h: "–¶—ñ–ª—ñ —á–∏—Å–ª–∞ –Ω–µ –º–∞—é—Ç—å –¥—Ä–æ–±–æ–≤–æ—ó —á–∞—Å—Ç–∏–Ω–∏. –ß–∏–º –±—ñ–ª—å—à–∏–π –º–æ–¥—É–ª—å –≤—ñ–¥'—î–º–Ω–æ–≥–æ —á–∏—Å–ª–∞, —Ç–∏–º –≤–æ–Ω–æ –º–µ–Ω—à–µ.", s: "-60 –ª–µ–∂–∏—Ç—å –Ω–∞–π–ª—ñ–≤—ñ—à–µ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ñ–π –ø—Ä—è–º—ñ–π." },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "2", q: "–¢–æ—á–∫–∞ M —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∞ –Ω–∞ 4 –∫–ª—ñ—Ç–∏–Ω–∫–∏ –ª—ñ–≤–æ—Ä—É—á –≤—ñ–¥ 0. –Ø–∫–æ–º—É —á–∏—Å–ª—É –≤–æ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î?", a: "-4", h: "–õ—ñ–≤–æ—Ä—É—á –≤—ñ–¥ –Ω—É–ª—è –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤—ñ–¥'—î–º–Ω—ñ —á–∏—Å–ª–∞.", s: "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ M –¥–æ—Ä—ñ–≤–Ω—é—î -4." },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "3", q: "–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –Ω–µ—Ä—ñ–≤–Ω–æ—Å—Ç—ñ: 1) -5 < 3; 2) 0 ‚â• -8; 3) -6 > -9; 4) -4 < -9", a: "4", h: "–ó–≥–∞–¥–∞–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—É –ø—Ä—è–º—É: -4 –ª–µ–∂–∏—Ç—å –ü–†–ê–í–Ü–®–ï –≤—ñ–¥ -9.", s: "-4 –±—ñ–ª—å—à–µ –∑–∞ -9, —Ç–æ–º—É –Ω–µ—Ä—ñ–≤–Ω—ñ—Å—Ç—å -4 < -9 —î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—é." },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "4", q: "–û–±—á–∏—Å–ª—ñ—Ç—å: \\( -12 + (-5) \\)", a: "-17", h: "–î–æ–¥–∞—î–º–æ –¥–≤–∞ –≤—ñ–¥'—î–º–Ω–∏—Ö —á–∏—Å–ª–∞ (–±–æ—Ä–≥ + –±–æ—Ä–≥).", s: "-(12 + 5) = -17" },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "5", q: "–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä—ñ–≤–Ω–æ—Å—Ç—ñ: 1) -4 + 3 = -7; 2) 10 - 25 = 15; 3) 6 - (-9) = 15", a: "3", h: "–ü–µ—Ä–µ–≤—ñ—Ä –∫–æ–∂–Ω—É. –ú—ñ–Ω—É—Å –Ω–∞ –º—ñ–Ω—É—Å –¥–∞—î –ø–ª—é—Å.", s: "6 - (-9) = 6 + 9 = 15. –¢—Ä–µ—Ç—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π." },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "6", q: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –±—É–ª–∞ 3 ¬∞C, –∞ –≤–≤–µ—á–µ—Ä—ñ –∑–Ω–∏–∑–∏–ª–∞—Å—è –Ω–∞ 8 ¬∞C. –í–∫–∞–∂–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–≤–µ—á–µ—Ä—ñ.", a: "-5", h: "3 - 8 = ?", s: "3 - 8 = -5 ¬∞C" },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "7", q: "–û–±—á–∏—Å–ª—ñ—Ç—å –º–æ–¥—É–ª—å: \\( |-4,5| \\)", a: "4.5", h: "–ú–æ–¥—É–ª—å –∑–∞–≤–∂–¥–∏ —Ä–æ–±–∏—Ç—å —á–∏—Å–ª–æ –¥–æ–¥–∞—Ç–Ω–∏–º (–∞–±–æ –Ω—É–ª–µ–º).", s: "|-4.5| = 4.5" },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "8", q: "–ó–Ω–∞–π–¥–∏ —Å—É–º—É: \\( 14 + (-20) \\)", a: "-6", h: "–í—ñ–¥–Ω—ñ–º–∞—î–º–æ –≤—ñ–¥ –±—ñ–ª—å—à–æ–≥–æ –º–æ–¥—É–ª—è –º–µ–Ω—à–∏–π —ñ —Å—Ç–∞–≤–∏–º–æ –∑–Ω–∞–∫ –±—ñ–ª—å—à–æ–≥–æ.", s: "-(20 - 14) = -6" },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "9", q: "–û–±—á–∏—Å–ª—ñ—Ç—å: \\( -8 - (-3) \\)", a: "-5", h: "–ó–∞–º—ñ–Ω–∏ -(-3) –Ω–∞ +3.", s: "-8 + 3 = -5" },
        { lvl: "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π", n: "10", q: "–Ø–∫–µ —á–∏—Å–ª–æ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–µ –¥–æ —á–∏—Å–ª–∞ -100?", a: "100", h: "–ü—Ä–æ—Ç–∏–ª–µ–∂–Ω–µ —á–∏—Å–ª–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –ª–∏—à–µ –∑–Ω–∞–∫–æ–º.", s: "-(-100) = 100" },

        // –°–ï–†–ï–î–ù–Ü–ô –†–Ü–í–ï–ù–¨
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å", n: "11", q: "–í–≤–µ–¥—ñ—Ç—å '—Ç–∞–∫' –∞–±–æ '–Ω—ñ': —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —â–æ –º–æ–¥—É–ª—å —á–∏—Å–ª–∞ -4,09 –±—ñ–ª—å—à–∏–π –∑–∞ 4?", a: "—Ç–∞–∫", h: "|-4,09| = 4,09. –ü–æ—Ä—ñ–≤–Ω—è–π 4,09 —ñ 4.", s: "4,09 > 4, —Ç–æ–º—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å '—Ç–∞–∫'." },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "12", q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏—Ä–∞–∑—É: \\( -2,4 - (-5,2) - 4,8 \\)", a: "-2", h: "–°–ø–µ—Ä—à—É —Ä–æ–∑–∫—Ä–∏–π –¥—É–∂–∫–∏: -2,4 + 5,2 - 4,8.", s: "(-2,4 - 4,8) + 5,2 = -7,2 + 5,2 = -2" },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "13", q: "–°–ø—Ä–æ—Å—Ç—ñ—Ç—å –≤–∏—Ä–∞–∑ \\( -(-a + 1,9) - (-2) \\) —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —è–∫—â–æ \\( a = 0 \\)", a: "0.1", h: "–†–æ–∑–∫—Ä–∏–π –¥—É–∂–∫–∏: a - 1,9 + 2. –ü–æ—Ç—ñ–º –ø—ñ–¥—Å—Ç–∞–≤ 0.", s: "0 - 1,9 + 2 = 0,1" },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "14", q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å —Ä—ñ–≤–Ω—è–Ω–Ω—è: \\( x - \\frac{2}{9} = -\\frac{1}{3} \\) (–≤–≤–µ–¥–∏ —è–∫ –¥—Ä—ñ–±, –Ω–∞–ø—Ä. -1/5)", a: "-1/9", h: "x = 2/9 - 1/3. –ó–≤–µ–¥–∏ –¥–æ —Å–ø—ñ–ª—å–Ω–æ–≥–æ –∑–Ω–∞–º–µ–Ω–Ω–∏–∫–∞ 9.", s: "x = 2/9 - 3/9 = -1/9" },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "15", q: "–û–±—á–∏—Å–ª—ñ—Ç—å: \\( 6,5 - 8,5 + 2 \\)", a: "0", h: "6,5 - 8,5 = -2", s: "-2 + 2 = 0" },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "16", q: "–û–±—á–∏—Å–ª—ñ—Ç—å: \\( -\\frac{1}{2} + 0,5 \\)", a: "0", h: "-1/2 —Ü–µ —Ç–µ —Å–∞–º–µ, —â–æ -0,5.", s: "-0,5 + 0,5 = 0" },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "17", q: "–†–æ–∑–∫—Ä–∏–π –¥—É–∂–∫–∏ —ñ –æ–±—á–∏—Å–ª–∏: \\( 10 - (12 - (-2)) \\)", a: "-4", h: "–°–ø–µ—Ä—à—É –≤ –¥—É–∂–∫–∞—Ö: 12 + 2 = 14.", s: "10 - 14 = -4" },
        { lvl: "–°–µ—Ä–µ–¥–Ω—ñ–π", n: "18", q: "–†–æ–∑–≤'—è–∂–∏: \\( x + 3 = -(-5) \\)", a: "2", h: "-(-5) = 5", s: "x + 3 = 5 => x = 2" },
        
        // –î–û–°–¢–ê–¢–ù–Ü–ô –†–Ü–í–ï–ù–¨
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å", n: "19", q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è: \\( |-7,2| - (-10 - 5,4 + 4,8) \\)", a: "17.8", h: "|-7,2| = 7,2. –í –¥—É–∂–∫–∞—Ö: -15,4 + 4,8 = -10,6.", s: "7,2 - (-10,6) = 7,2 + 10,6 = 17,8" },
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π", n: "20", q: "–°–∫—ñ–ª—å–∫–∏ –≤—Å—å–æ–≥–æ —Ü—ñ–ª–∏—Ö —á–∏—Å–µ–ª –∑–∞–¥–æ–≤–æ–ª—å–Ω—è—é—Ç—å –Ω–µ—Ä—ñ–≤–Ω—ñ—Å—Ç—å \\( |x| \\le 4 \\)?", a: "9", h: "–¶–µ —á–∏—Å–ª–∞ –≤—ñ–¥ -4 –¥–æ 4 –≤–∫–ª—é—á–Ω–æ. –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ –Ω—É–ª—å!", s: "–¶–µ -4, -3, -2, -1, 0, 1, 2, 3, 4. –†–∞–∑–æ–º 9 —á–∏—Å–µ–ª." },
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π", n: "21", q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å —Ä—ñ–≤–Ω—è–Ω–Ω—è: \\( 12 - (x + 2) = -4 \\)", a: "14", h: "–†–æ–∑–∫—Ä–∏–π –¥—É–∂–∫–∏: 12 - x - 2 = -4.", s: "10 - x = -4 => x = 10 - (-4) = 14" },
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π", n: "22", q: "–ó–Ω–∞–π–¥—ñ—Ç—å –î–û–î–ê–¢–ù–ò–ô –∫–æ—Ä—ñ–Ω—å —Ä—ñ–≤–Ω—è–Ω–Ω—è: \\( |x| - 3,5 = -0,5 \\)", a: "3", h: "–ó–Ω–∞–π–¥–∏ —Å–ø–æ—á–∞—Ç–∫—É |x|.", s: "|x| = 3,5 - 0,5 = 3. –ö–æ—Ä–µ–Ω—ñ 3 —ñ -3. –î–æ–¥–∞—Ç–Ω–∏–π: 3." },
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π", n: "23", q: "–°–ø—Ä–æ—Å—Ç–∏ –≤–∏—Ä–∞–∑: \\( - (x - 5) + (x - 2) \\)", a: "3", h: "–†–æ–∑–∫—Ä–∏–π –ø–µ—Ä—à—ñ –¥—É–∂–∫–∏ –∑ –º—ñ–Ω—É—Å–æ–º, –¥—Ä—É–≥—ñ –∑ –ø–ª—é—Å–æ–º. –Ü–∫—Å–∏ –∑–Ω–∏–∫–Ω—É—Ç—å.", s: "-x + 5 + x - 2 = 3" },
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π", n: "24", q: "–û–±—á–∏—Å–ª—ñ—Ç—å: \\( -0,8 - (-1,2) + (-0,4) \\)", a: "0", h: "-(-1,2) = 1,2", s: "-0,8 + 1,2 - 0,4 = 0,4 - 0,4 = 0" },
        { lvl: "–î–æ—Å—Ç–∞—Ç–Ω—ñ–π", n: "25", q: "–ó–Ω–∞–π–¥–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ —Ç–æ—á–∫–∞–º–∏ A(-5) —ñ B(12) –Ω–∞ –æ—Å—ñ.", a: "17", h: "–í—ñ–¥—Å—Ç–∞–Ω—å = |B - A|", s: "|12 - (-5)| = |12 + 5| = 17" },

        // –í–ò–°–û–ö–ò–ô –†–Ü–í–ï–ù–¨
        { lvl: "–í–∏—Å–æ–∫–∏–π —Ä—ñ–≤–µ–Ω—å (–ë–û–°)", n: "26", q: "–ó–Ω–∞–π–¥—ñ—Ç—å —Å—É–º—É –≤—Å—ñ—Ö —Ü—ñ–ª–∏—Ö —á–∏—Å–µ–ª –≤—ñ–¥ -51 –≤–∫–ª—é—á–Ω–æ –¥–æ 48 –≤–∫–ª—é—á–Ω–æ.", a: "-150", h: "–ß–∏—Å–ª–∞ –≤—ñ–¥ -48 –¥–æ 48 —É —Å—É–º—ñ –¥–∞—é—Ç—å 0. –Ø–∫—ñ —á–∏—Å–ª–∞ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –ø–∞—Ä–∏?", s: "–ó–∞–ª–∏—à–∞—é—Ç—å—Å—è -51, -50, -49. –á—Ö —Å—É–º–∞: -150." },
        { lvl: "–í–∏—Å–æ–∫–∏–π (–ë–û–°)", n: "27", q: "–ó–Ω–∞–π–¥—ñ—Ç—å –ù–ê–ô–ë–Ü–õ–¨–®–ò–ô –∫–æ—Ä—ñ–Ω—å: \\( -9 - |x + 5| = -12 \\)", a: "-2", h: "–ü–µ—Ä–µ–Ω–µ—Å–∏ -9. –û—Ç—Ä–∏–º–∞—î—à -|x+5| = -3, –∞–±–æ |x+5| = 3.", s: "x+5 = 3 (x=-2) –∞–±–æ x+5 = -3 (x=-8). –ù–∞–π–±—ñ–ª—å—à–∏–π: -2." },
        { lvl: "–í–∏—Å–æ–∫–∏–π (–ë–û–°)", n: "28", q: "–ü—Ä–∏ —è–∫–æ–º—É –∑–Ω–∞—á–µ–Ω–Ω—ñ \\( a \\) –≤–∏—Ä–∞–∑ \\( 2 - (2 - (-2 + a)) \\) –¥–æ—Ä—ñ–≤–Ω—é—î -6?", a: "-4", h: "–°–ø–æ—á–∞—Ç–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–ø—Ä–æ—Å—Ç–∏ –≤–∏—Ä–∞–∑ —É –¥—É–∂–∫–∞—Ö.", s: "2 - (2 + 2 - a) = 2 - 4 + a = a - 2. –†—ñ–≤–Ω—è–Ω–Ω—è: a - 2 = -6 => a = -4." },
        { lvl: "–í–∏—Å–æ–∫–∏–π (–ë–û–°)", n: "29", q: "–ù–∞ –æ—Å—ñ –¥–∞–Ω–æ A(-3) —ñ B(5). –ó–Ω–∞–π–¥–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É —Ç–æ—á–∫–∏ C, —è–∫–∞ —î —Å–µ—Ä–µ–¥–∏–Ω–æ—é –≤—ñ–¥—Ä—ñ–∑–∫–∞ AB.", a: "1", h: "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ —Å–µ—Ä–µ–¥–∏–Ω–∏ = (A + B) / 2", s: "(-3 + 5) / 2 = 2 / 2 = 1" },
        { lvl: "–í–∏—Å–æ–∫–∏–π (–ë–û–°)", n: "30", q: "–†–æ–∑–≤'—è–∂–∏: \\( ||x| - 2| = 0 \\)", a: "2, -2", h: "–ú–æ–¥—É–ª—å –¥–æ—Ä—ñ–≤–Ω—é—î 0 —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∏—Ä–∞–∑ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–æ—Ä—ñ–≤–Ω—é—î 0. –ù–∞–ø–∏—à–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —á–µ—Ä–µ–∑ –∫–æ–º—É (–Ω–∞–ø—Ä. 5, -5).", s: "|x| - 2 = 0 => |x| = 2. –í—ñ–¥–ø–æ–≤—ñ–¥—å: 2, -2." }
    ];

    const testData = [
        { q: "–û–±—á–∏—Å–ª—ñ—Ç—å: \\( |-15| - |-5| \\)", a: "10" },
        { q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å: \\( 5 - (x - 3) = 8 \\)", a: "0" },
        { q: "–°—É–º–∞ —á–∏—Å–µ–ª -8, 5 —ñ -2 –¥–æ—Ä—ñ–≤–Ω—é—î:", a: "-5" }
    ];

    let solvedCount = 0;
    let currentLvl = "";

    function initTasks() {
        const container = document.getElementById('tasks-list');
        tasksData.forEach((task, idx) => {
            
            // –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä—ñ–≤–Ω—è, —è–∫—â–æ –≤—ñ–Ω –∑–º—ñ–Ω–∏–≤—Å—è
            if (task.lvl !== currentLvl) {
                currentLvl = task.lvl;
                const lvlHeader = document.createElement('div');
                lvlHeader.className = "mt-8 mb-4 font-black text-slate-400 uppercase tracking-widest text-sm flex items-center gap-4";
                lvlHeader.innerHTML = `<span>${currentLvl}</span> <div class="flex-1 h-px bg-slate-200"></div>`;
                container.appendChild(lvlHeader);
            }

            const div = document.createElement('div');
            div.id = `task-${idx}`;
            div.className = "task-card bg-white p-6 rounded-[2rem] animate-slide-up";
            div.style.animationDelay = `${idx * 0.05}s`;
            
            div.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <span class="bg-slate-100 text-slate-500 text-[10px] font-black uppercase px-3 py-1 rounded-full">–ó–ê–í–î–ê–ù–ù–Ø ${task.n}</span>
                    <span id="check-${idx}" class="hidden flex items-center gap-1 text-emerald-500 font-bold text-xs bg-emerald-50 px-2 py-1 rounded-full">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        –í–Ü–†–ù–û
                    </span>
                </div>
                <div class="text-lg font-semibold text-slate-800 mb-5 leading-relaxed">${task.q}</div>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="input-${idx}" onkeypress="if(event.key==='Enter') checkTask(${idx})" 
                        class="flex-1 bg-slate-50 rounded-2xl px-5 py-4 border-2 border-slate-200 focus:border-indigo-500 focus:bg-white outline-none transition-all text-lg font-medium placeholder-slate-400 shadow-inner" 
                        placeholder="–¢–≤–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">
                    <button onclick="checkTask(${idx})" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black hover:bg-indigo-500 hover:shadow-lg hover:shadow-indigo-500/30 transition-all active:scale-95">
                        –ü–ï–†–ï–í–Ü–†–ò–¢–ò
                    </button>
                </div>
                <div class="mt-4 flex items-center gap-4 border-t border-slate-100 pt-4">
                    <button onclick="toggleInfo(${idx}, 'hint')" class="flex items-center gap-1 text-xs font-bold text-indigo-500 hover:text-indigo-700 transition-colors">
                        <span class="text-lg opacity-80">üí°</span> –ü—ñ–¥–∫–∞–∑–∫–∞
                    </button>
                    <button onclick="toggleInfo(${idx}, 'sol')" class="flex items-center gap-1 text-xs font-bold text-slate-400 hover:text-slate-600 ml-auto transition-colors">
                        <span class="text-lg opacity-80">üìù</span> –†–æ–∑–≤'—è–∑–æ–∫
                    </button>
                </div>
                <div id="hint-${idx}" class="hidden mt-3 p-4 bg-indigo-50/50 rounded-2xl text-sm text-indigo-800 italic border border-indigo-100">${task.h}</div>
                <div id="sol-${idx}" class="hidden mt-3 p-4 bg-slate-50 rounded-2xl text-sm font-mono border border-slate-200 text-slate-700"><span class="text-emerald-500 font-bold mr-2">‚úì</span> ${task.s}</div>
            `;
            container.appendChild(div);
        });
        MathJax.typeset();
    }

    function checkTask(idx) {
        let val = document.getElementById(`input-${idx}`).value.trim().toLowerCase().replace(/,/g, '.').replace(/\s+/g, '');
        let expected = tasksData[idx].a.toLowerCase().replace(/,/g, '.').replace(/\s+/g, '');
        
        // –î–æ–∑–≤–æ–ª—è—î–º–æ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏ –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥—è—Ö (–Ω–∞–ø—Ä. "2,-2" —Ç–∞ "-2,2")
        let isCorrect = val === expected;
        if (expected.includes(',') && val.includes(',')) {
            let valArr = val.split(',').sort();
            let expArr = expected.split(',').sort();
            if (valArr.join(',') === expArr.join(',')) isCorrect = true;
        }

        const el = document.getElementById(`input-${idx}`);
        const card = document.getElementById(`task-${idx}`);
        
        if (isCorrect) {
            if (!card.classList.contains('solved-card')) {
                solvedCount++;
                updateProgress();
            }
            card.classList.add('solved-card');
            document.getElementById(`check-${idx}`).classList.remove('hidden');
            el.classList.add('bg-emerald-50', 'text-emerald-700', 'border-emerald-200');
            el.disabled = true; // –ë–ª–æ–∫—É—î–º–æ —ñ–Ω–ø—É—Ç –ø—ñ—Å–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        } else {
            el.classList.add('border-red-400', 'bg-red-50', 'text-red-600');
            card.style.transform = "translateX(5px)";
            setTimeout(() => card.style.transform = "translateX(-5px)", 100);
            setTimeout(() => card.style.transform = "translateX(0)", 200);
            setTimeout(() => el.classList.remove('border-red-400', 'bg-red-50', 'text-red-600'), 800);
        }
    }

    function updateProgress() {
        const p = (solvedCount / tasksData.length) * 100;
        document.getElementById('prog-bar').style.width = p + '%';
        document.getElementById('prog-label').innerText = `${solvedCount} –∑ ${tasksData.length} –∑–∞–≤–¥–∞–Ω—å`;
        
        if (solvedCount === tasksData.length) {
            const tz = document.getElementById('test-zone');
            tz.classList.remove('hidden');
            setTimeout(() => { tz.classList.remove('opacity-0'); }, 100);
            initTest();
            setTimeout(() => tz.scrollIntoView({behavior: 'smooth'}), 500);
        }
    }

    function initTest() {
        const cont = document.getElementById('test-questions');
        if (cont.innerHTML !== "") return;
        testData.forEach((t, i) => {
            cont.innerHTML += `
            <div class="p-5 bg-white/5 rounded-3xl border border-white/10 backdrop-blur-sm">
                <p class="mb-4 text-lg font-medium text-blue-50">${i+1}. ${t.q}</p>
                <input type="text" id="test-input-${i}" class="w-full bg-slate-800/50 text-white border border-slate-600 rounded-xl px-4 outline-none focus:border-emerald-400 py-3 transition-colors" placeholder="–¢–≤–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">
            </div>`;
        });
        MathJax.typeset();
    }

    function checkTest() {
        let correct = 0;
        testData.forEach((t, i) => {
            let v = document.getElementById(`test-input-${i}`).value.trim().replace(/,/g, '.').replace(/\s+/g, '');
            if (v === t.a) correct++;
        });
        alert(`üèÜ –¢–µ—Å—Ç –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: ${correct} –∑ ${testData.length}. \n\n–ù–∞—Ç–∏—Å–Ω–∏ "–ü–Ü–î–ë–ò–¢–ò –ü–Ü–î–°–£–ú–ö–ò" –≤–Ω–∏–∑—É –µ–∫—Ä–∞–Ω—É.`);
    }

    function toggleInfo(idx, type) {
        const el = document.getElementById(`${type}-${idx}`);
        // –ó–∞–∫—Ä–∏—Ç–∏ —ñ–Ω—à–∏–π –±–ª–æ–∫, —è–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π
        const otherType = type === 'hint' ? 'sol' : 'hint';
        document.getElementById(`${otherType}-${idx}`).classList.add('hidden');
        
        if (el.classList.contains('hidden')) {
            el.classList.remove('hidden');
            el.style.animation = "slideUp 0.3s ease-out";
        } else {
            el.classList.add('hidden');
        }
    }

    // ==========================================
    // –õ–û–ì–Ü–ö–ê –î–û–®–ö–ò (CANVAS)
    // ==========================================
    const canvas = document.getElementById('whiteboard');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    let drawing = false, tool = 'pen';
    
    function initCanvas() {
        const p = document.getElementById('canvas-parent');
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–º—ñ—Å—Ç –ø–µ—Ä–µ–¥ —Ä–µ—Å–∞–π–∑–æ–º
        let imgData = null;
        if(canvas.width > 0 && canvas.height > 0) {
            imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        }
        
        canvas.width = p.clientWidth; 
        canvas.height = p.clientHeight;
        ctx.lineCap = 'round'; 
        ctx.lineJoin = 'round';
        
        // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –≤–º—ñ—Å—Ç
        if(imgData) {
            ctx.putImageData(imgData, 0, 0);
        }
    }

    window.addEventListener('resize', initCanvas);

    function setTool(t) { 
        tool = t; 
        document.getElementById('btn-pen').className = t==='pen'?'p-3 rounded-xl tool-active transition-all':'p-3 rounded-xl hover:bg-slate-100 transition-all text-slate-400';
        document.getElementById('btn-eraser').className = t==='eraser'?'p-3 rounded-xl tool-active transition-all':'p-3 rounded-xl hover:bg-slate-100 transition-all text-slate-400';
    }

    function getPos(e) { 
        const r = canvas.getBoundingClientRect(); 
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - r.left, y: clientY - r.top }; 
    }

    const startDraw = (e) => { 
        e.preventDefault(); 
        drawing = true; 
        ctx.beginPath(); 
        const pos = getPos(e); 
        ctx.moveTo(pos.x, pos.y); 
        
        // –î–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è –∫—Ä–∞–ø–∫–∏ –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–º—É –∫–ª—ñ–∫—É
        ctx.lineTo(pos.x, pos.y);
        ctx.strokeStyle = tool === 'eraser' ? '#ffffff' : '#1e293b';
        ctx.lineWidth = tool === 'eraser' ? 30 : 3;
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    };
    
    const doDraw = (e) => { 
        if (!drawing) return; 
        e.preventDefault();
        const pos = getPos(e); 
        ctx.strokeStyle = tool === 'eraser' ? '#ffffff' : '#1e293b';
        ctx.lineWidth = tool === 'eraser' ? 40 : 3; // –ì—É–º–∫–∞ —Ç—Ä–æ—Ö–∏ –±—ñ–ª—å—à–∞
        ctx.lineTo(pos.x, pos.y); 
        ctx.stroke();
    };
    const stopDraw = () => drawing = false;

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', doDraw);
    window.addEventListener('mouseup', stopDraw);
    
    canvas.addEventListener('touchstart', startDraw, {passive: false});
    canvas.addEventListener('touchmove', doDraw, {passive: false});
    window.addEventListener('touchend', stopDraw);

    function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }

    // Smart Tool: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∞ –ø—Ä—è–º–∞
    function drawCoordinateLine() {
        clearCanvas();
        const w = canvas.width;
        const h = canvas.height;
        const cy = Math.floor(h / 2) + 0.5; // +0.5 –¥–ª—è —á—ñ—Ç–∫–æ—Å—Ç—ñ –ª—ñ–Ω—ñ–π –Ω–∞ canvas
        
        ctx.strokeStyle = '#4f46e5';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        // –ì–æ–ª–æ–≤–Ω–∞ –≤—ñ—Å—å
        ctx.moveTo(30, cy);
        ctx.lineTo(w - 30, cy);
        
        // –°—Ç—Ä—ñ–ª–∫–∞
        ctx.lineTo(w - 45, cy - 8);
        ctx.moveTo(w - 30, cy);
        ctx.lineTo(w - 45, cy + 8);
        
        ctx.font = 'bold 14px "Plus Jakarta Sans", sans-serif';
        ctx.fillStyle = '#1e293b';
        ctx.textAlign = 'center';
        
        const cx = w / 2;
        const step = Math.min((w - 100) / 20, 50); // –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫
        
        // –ü–æ–¥—ñ–ª–∫–∏
        for(let i = -10; i <= 10; i++) {
            const x = Math.floor(cx + i * step) + 0.5;
            if(x > 40 && x < w - 50) {
                ctx.moveTo(x, cy - 6);
                ctx.lineTo(x, cy + 6);
                
                // –ü—ñ–¥–ø–∏—Å–∏ –¥–ª—è 0 —ñ –ø–∞—Ä–Ω–∏—Ö
                if (i === 0) {
                    ctx.fillText(i, x, cy + 25);
                    ctx.fillStyle = '#ef4444'; // —á–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –Ω—É–ª—è
                    ctx.beginPath();
                    ctx.arc(x, cy, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#1e293b';
                    ctx.beginPath(); // –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —à–ª—è—Ö –¥–ª—è –ª—ñ–Ω—ñ—ó
                } else if (i % 2 === 0 || i === 1 || i === -1) {
                    ctx.fillText(i, x, cy + 25);
                }
            }
        }
        ctx.stroke();
        
        // –ü—ñ–¥–ø–∏—Å –æ—Å—ñ
        ctx.fillStyle = '#4f46e5';
        ctx.fillText('x', w - 15, cy + 5);
        
        setTool('pen');
    }

    // ==========================================
    // –§–Ü–ù–ê–õ
    // ==========================================
    function finishLesson() {
        const score = Math.round((solvedCount / tasksData.length) * 100);
        const modal = document.getElementById('modal');
        const content = document.getElementById('modal-content');
        
        document.getElementById('res-score').innerText = `${solvedCount} / ${tasksData.length}`;
        
        let msg = "", title = "", emoji = "üéØ";
        if (score >= 90) {
            title = "–ë–ª–∏—Å–∫—É—á–µ!";
            msg = "–¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –≥–µ–Ω—ñ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏! –†–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —á–∏—Å–ª–∞ –ø—ñ–¥–∫–æ—Ä–µ–Ω—ñ. üöÄ";
            emoji = "üëë";
        } else if (score >= 60) {
            title = "–î–æ–±—Ä–∞ —Ä–æ–±–æ—Ç–∞!";
            msg = "–¢–∏ –≤–ø–µ–≤–Ω–µ–Ω–æ —Ä—É—Ö–∞—î—à—Å—è –≤–ø–µ—Ä–µ–¥. –©–µ —Ç—Ä–æ—Ö–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏, —ñ —Ç–∏ —Å—Ç–∞–Ω–µ—à –º–∞–π—Å—Ç—Ä–æ–º! üí™";
            emoji = "üåü";
        } else {
            title = "–ù–µ –∑–¥–∞–≤–∞–π—Å—è!";
            msg = "–¢–µ–º–∞ –Ω–µ–ø—Ä–æ—Å—Ç–∞, –∞–ª–µ —Ç–∏ –º–æ–ª–æ–¥–µ—Ü—å, —â–æ –Ω–∞–º–∞–≥–∞—î—à—Å—è. –°–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—á–∏—Ç–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —ñ –ø—Ä–æ–π—Ç–∏ —â–µ —Ä–∞–∑! üß†";
            emoji = "üå±";
        }

        document.getElementById('res-title').innerText = title;
        document.getElementById('res-msg').innerText = msg;
        document.getElementById('res-emoji').innerText = emoji;
        
        modal.classList.remove('hidden');
        // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ –º–æ–¥–∞–ª–∫–∏
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            content.classList.remove('scale-95');
        }, 10);
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    window.onload = () => { 
        initTasks(); 
        setTimeout(initCanvas, 200); 
    };
</script>
</body>
</html>